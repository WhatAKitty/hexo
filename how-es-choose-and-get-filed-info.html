<!DOCTYPE HTML><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>ES查询中如何获取并解析查询字段 | WhatAKitty Daily | A Programmer&#39;s Daily Record</title><meta name="author" content="WhatAKitty"><meta name="description" content="Just A Simple Programmer."><meta name="keywords" content="es,elasticsearch,java,field,search,index,cache,Blog, SSL, Nodejs, DevOps, Spring, Spring Cloud, Jenkins, Docker, JIRA, CI"><meta id="viewport" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:title" content="ES查询中如何获取并解析查询字段"><meta property="og:site_name" content="WhatAKitty Daily"><meta property="og:image" content="/favicon.ico"><link href="/favicon.ico" rel="icon"><link rel="alternate" href="/atom.xml" title="WhatAKitty Daily" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">WhatAKitty Daily</a></h1><p class="site-description">A Programmer&#39;s Daily Record</p></div><nav class="site-navigation"><ul><li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/projects">项目</a></li><li><a href="/categories/JavaSources">Java Sources</a></li><li><a href="/categories/Java/Spring/SpringSources">Spring Sources</a></li><li><a href="/atom.xml">订阅</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class="article-title"><span>ES查询中如何获取并解析查询字段</span></h3><div class="article-top-meta"><span class="posted-on"><a href="/how-es-choose-and-get-filed-info.html" rel="bookmark">WhatAKitty &emsp; <time class="entry-date published" datetime="2019-10-02T16:22:19.000Z">2019-10-03 </time>&emsp; <span id="busuanzi_container_page_pv">阅读次数<span id="busuanzi_value_page_pv">loading...</span></span></a></span></div><div class="article-content"><div class="entry"><h3 id="&#x80CC;&#x666F;"><a href="#&#x80CC;&#x666F;" class="headerlink" title="&#x80CC;&#x666F;"></a>&#x80CC;&#x666F;</h3><p>&#x6700;&#x8FD1;&#x5728;&#x5B66;&#x4E60;Elasticsearch&#x76F8;&#x5173;&#x7684;&#x4E00;&#x4E9B;&#x539F;&#x7406;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6620;&#x50CF;&#x4E2D;ES&#x7684;text&#x5B57;&#x6BB5;&#x5982;&#x679C;&#x5B58;&#x5728;keyword&#x7684;fields&#xFF0C;&#x5219;&#x4F1A;&#x5728;&#x805A;&#x5408;&#x7684;&#x65F6;&#x5019;&#x9009;&#x62E9;keyword&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x805A;&#x5408;&#xFF0C;&#x540C;&#x65F6;&#x5728;&#x6587;&#x672C;&#x68C0;&#x7D22;&#x7684;&#x65F6;&#x5019;&#x6839;&#x636E;text&#x7C7B;&#x578B;&#x5206;&#x8BCD;&#x68C0;&#x7D22;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x60F3;&#x63A2;&#x7A76;&#x4E0B;&#x8FD9;&#x4E2A;&#x7684;&#x5B9E;&#x73B0;&#x8FC7;&#x7A0B;&#x3002;</p><h3 id="ES&#x67E5;&#x8BE2;&#x539F;&#x7406;"><a href="#ES&#x67E5;&#x8BE2;&#x539F;&#x7406;" class="headerlink" title="ES&#x67E5;&#x8BE2;&#x539F;&#x7406;"></a>ES&#x67E5;&#x8BE2;&#x539F;&#x7406;</h3><p>&#x9700;&#x8981;&#x4E86;&#x89E3;keyword&#x7684;&#x9009;&#x62E9;&#x90ED;&#x6210;&#xFF0C;&#x9700;&#x8981;&#x6307;&#x5B9A;&#x5982;&#x4E0B;&#x4E24;&#x70B9;&#xFF1A;</p><ol><li>&#x5B57;&#x6BB5;&#x5728;&#x542F;&#x52A8;&#x8FC7;&#x7A0B;&#x4E2D;&#x5982;&#x4F55;&#x521D;&#x59CB;&#x5316;</li><li>&#x67E5;&#x8BE2;&#x7684;&#x65F6;&#x5019;&#x5982;&#x4F55;&#x7B5B;&#x9009;&#x9700;&#x8981;&#x7684;&#x5B57;&#x6BB5;&#x4EE5;&#x53CA;&#x9009;&#x62E9;&#x7C7B;&#x578B;</li></ol><h4 id="ES&#x521D;&#x59CB;&#x5316;&#x6D41;&#x7A0B;"><a href="#ES&#x521D;&#x59CB;&#x5316;&#x6D41;&#x7A0B;" class="headerlink" title="ES&#x521D;&#x59CB;&#x5316;&#x6D41;&#x7A0B;"></a>ES&#x521D;&#x59CB;&#x5316;&#x6D41;&#x7A0B;</h4><p>&#x901A;&#x8FC7;&#x4EE5;&#x4E0B;&#x65F6;&#x5E8F;&#x56FE;&#x8BB0;&#x5F55;&#x4E0B;ES&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x5927;&#x81F4;&#x8FC7;&#x7A0B;&#xFF1A;</p><pre class="mermaid">sequenceDiagram;
  Elasticsearch-&gt;&gt;Command: &#x4E3B;&#x7A0B;&#x5E8F;&#x5165;&#x53E3;&#xFF0C;&#x89E3;&#x6790;&#x547D;&#x4EE4;&#x53C2;&#x6570;
  Command-&gt;&gt;Command: &#x6CE8;&#x518C;closeHook&#xFF0C;&#x6267;&#x884C;&#x4E3B;&#x51FD;&#x6570;&#x524D;&#x7F6E;hook&#x51FD;&#x6570;beforeMain.run()
  Command-&gt;&gt;EnvironmentAwareCommand: &#x6267;&#x884C;&#x73AF;&#x5883;&#x53C2;&#x6570;&#x521D;&#x59CB;&#x5316;
  EnvironmentAwareCommand-&gt;&gt;Elasticsearch: &#x6267;&#x884C;&#x542F;&#x52A8;&#x5177;&#x4F53;&#x547D;&#x4EE4;
  Elasticsearch-&gt;&gt;Elasticsearch: &#x53C2;&#x6570;&#x89E3;&#x6790;
  Elasticsearch-&gt;&gt;Bootstrap: &#x6267;&#x884C;&#x521D;&#x59CB;&#x5316;&#x9759;&#x6001;&#x65B9;&#x6CD5;init
  Bootstrap-&gt;&gt;Bootstrap: &#x5B9E;&#x4F8B;&#x5316;Bootstrap&#xFF0C;&#x521D;&#x59CB;&#x5316;keepAlive&#x7EBF;&#x7A0B;
  Bootstrap-&gt;&gt;Bootstrap: &#x521B;&#x5EFA;&#x4E0A;&#x4E0B;&#x6587;&#x73AF;&#x5883;&#xFF0C;&#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x7684;&#x65E5;&#x5FD7;&#x914D;&#x7F6E;
  Bootstrap-&gt;&gt;Bootstrap: &#x521B;&#x5EFA;PID&#x6587;&#x4EF6;
  Bootstrap-&gt;&gt;Bootstrap: &#x68C0;&#x67E5;luence&#x7248;&#x672C;
  Bootstrap-&gt;&gt;Bootstrap: &#x521D;&#x59CB;&#x5316;&#x63D2;&#x4EF6;&#x8FDB;&#x7A0B;&#xFF0C;&#x521D;&#x59CB;&#x5316;&#x8282;&#x70B9;
  Bootstrap-&gt;&gt;Bootstrap: &#x8282;&#x70B9;&#x542F;&#x52A8;&#x4EE5;&#x53CA;&#x4FDD;&#x6D3B;&#x7EBF;&#x7A0B;&#x542F;&#x52A8;
  BootStrap-&gt;&gt;Node: &#x5C1D;&#x8BD5;&#x542F;&#x52A8;&#x8282;&#x70B9;
  Node-&gt;&gt;Node: &#x8282;&#x70B9;&#x72B6;&#x6001;&#x66F4;&#x6539;
  Node-&gt;&gt;Node: &#x5404;&#x670D;&#x52A1;&#x521D;&#x59CB;&#x5316;&#x542F;&#x52A8;
  Node-&gt;&gt;Node: Netty&#x670D;&#x52A1;&#x542F;&#x52A8;
  alt: &#x5F53;&#x524D;&#x8282;&#x70B9;&#x4E3A;Master/Data
    Node-&gt;&gt;Node: &#x83B7;&#x53D6;GatewayMetaState&#x5B9E;&#x4F8B;
    Node-&gt;&gt;GatewayMetaState: &#x6267;&#x884C;loadMetaState&#x8F7D;&#x5165;&#x5143;&#x4FE1;&#x606F;
    GatewayMetaState-&gt;&gt;MetaStateService: &#x6267;&#x884C;loadFullState&#x65B9;&#x6CD5;&#x8F7D;&#x5165;&#x5168;&#x5C40;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x7D22;&#x5F15;&#x72B6;&#x6001;
    MetaStateService-&gt;&gt;MetaStateService: &#x8F7D;&#x5165;&#x5168;&#x5C40;&#x72B6;&#x6001;
    MetaStateService-&gt;&gt;MetaStateService: &#x67E5;&#x627E;&#x6240;&#x6709;&#x7684;&#x7D22;&#x5F15;&#x8DEF;&#x5F84;
    MetaStateService-&gt;&gt;MetaStateService: &#x89E3;&#x6790;&#x6BCF;&#x4E2A;&#x7D22;&#x5F15;&#x8DEF;&#x5F84;&#xFF0C;&#x8F7D;&#x5165;&#x6700;&#x65B0;&#x7684;&#x72B6;&#x6001;
    MetaStateService-&gt;&gt;MetaStateService: &#x5C06;&#x7D22;&#x5F15;&#x72B6;&#x6001;&#x653E;&#x5165;&#x5168;&#x5C40;&#x72B6;&#x6001;&#x5185;&#x7F13;&#x5B58;
  else:
    Node-&gt;&gt;Node: &#x521B;&#x5EFA;&#x7A7A;&#x7684;&#x5143;&#x4FE1;&#x606F;
  end
  Node-&gt;&gt;Node: &#x542F;&#x52A8;Discovery&#x670D;&#x52A1;&#x4EE5;&#x53CA;Cluster&#x670D;&#x52A1;
  Node-&gt;&gt;Node: &#x8282;&#x70B9;Transport&#x670D;&#x52A1;&#x5F00;&#x59CB;&#x63A5;&#x6536;&#x8BF7;&#x6C42;
  Node-&gt;&gt;Node: &#x521D;&#x59CB;&#x5316;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x76D1;&#x542C;&#x96C6;&#x7FA4;&#x72B6;&#x6001;&#x53D8;&#x66F4;
  alt: &#x542F;&#x7528;HTTP&#x6A21;&#x5757;
    Node-&gt;&gt;Node: &#x521D;&#x59CB;&#x5316;HTTP&#x670D;&#x52A1;&#xFF0C;&#x5E76;&#x542F;&#x52A8;
  end
  alt: &#x662F;&#x5426;&#x5C06;&#x7AEF;&#x53E3;&#x4FE1;&#x606F;&#x5199;&#x5165;&#x6587;&#x4EF6;
    alt: &#x542F;&#x7528;HTTP&#x6A21;&#x5757;
      Node-&gt;&gt;Node: &#x5C06;http&#x7AEF;&#x53E3;&#x5199;&#x5165;
    end
    Node-&gt;&gt;Node: &#x5C06;transport&#x7AEF;&#x53E3;&#x5199;&#x5165;
  end
  Node-&gt;&gt;Node: &#x96C6;&#x7FA4;&#x63D2;&#x4EF6;&#x6267;&#x884C;onNodeStarted&#x65B9;&#x6CD5;&#x8FDB;&#x884C;&#x8282;&#x70B9;&#x521D;&#x59CB;&#x5316;</pre><p>&#x4E0A;&#x8FF0;&#x6D41;&#x7A0B;&#x5927;&#x81F4;&#x5C06;ES&#x6574;&#x4E2A;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x5927;&#x6982;&#x8BB2;&#x8FF0;&#x4E86;&#x4E00;&#x904D;&#xFF0C;&#x5177;&#x4F53;&#x4E86;&#x89E3;&#x4E0B;&#x5728;&#x52A0;&#x8F7D;&#x8FC7;&#x7A0B;&#x4E2D;&#x5982;&#x4F55;&#x89E3;&#x6790;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x5E76;&#x5C06;&#x5176;&#x52A0;&#x5165;&#x7F13;&#x5B58;&#x3002;</p><p>&#x5728;&#x4E0A;&#x8FF0;&#x6D41;&#x7A0B;&#x4E2D;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x5982;&#x4E0B;&#x8FD9;&#x4E00;&#x5757;&#x662F;&#x91CD;&#x70B9;&#xFF1A;</p><pre class="mermaid">sequenceDiagram;
  Node-&gt;&gt;Node: &#x83B7;&#x53D6;GatewayMetaState&#x5B9E;&#x4F8B;
  Node-&gt;&gt;GatewayMetaState: &#x6267;&#x884C;loadMetaState&#x8F7D;&#x5165;&#x5143;&#x4FE1;&#x606F;
  GatewayMetaState-&gt;&gt;MetaStateService: &#x6267;&#x884C;loadFullState&#x65B9;&#x6CD5;&#x8F7D;&#x5165;&#x5168;&#x5C40;&#x72B6;&#x6001;&#x4EE5;&#x53CA;&#x7D22;&#x5F15;&#x72B6;&#x6001;
  MetaStateService-&gt;&gt;MetaStateService: &#x8F7D;&#x5165;&#x5168;&#x5C40;&#x72B6;&#x6001;
  MetaStateService-&gt;&gt;MetaStateService: &#x67E5;&#x627E;&#x6240;&#x6709;&#x7684;&#x7D22;&#x5F15;&#x8DEF;&#x5F84;
  MetaStateService-&gt;&gt;MetaStateService: &#x89E3;&#x6790;&#x6BCF;&#x4E2A;&#x7D22;&#x5F15;&#x8DEF;&#x5F84;&#xFF0C;&#x8F7D;&#x5165;&#x6700;&#x65B0;&#x7684;&#x72B6;&#x6001;
  MetaStateService-&gt;&gt;MetaStateService: &#x5C06;&#x7D22;&#x5F15;&#x72B6;&#x6001;&#x653E;&#x5165;&#x5168;&#x5C40;&#x72B6;&#x6001;&#x5185;&#x7F13;&#x5B58;</pre><p>&#x8F7D;&#x5165;&#x6BCF;&#x4E2A;&#x7D22;&#x5F15;&#x6700;&#x65B0;&#x7684;&#x72B6;&#x6001;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  T <span class="title">loadLatestState</span><span class="params">(Logger logger, NamedXContentRegistry namedXContentRegistry, Path... dataLocations)</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">  List&lt;PathAndStateId&gt; files = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  <span class="keyword">long</span> maxStateId = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">boolean</span> maxStateIdIsLegacy = <span class="keyword">true</span>;</span><br><span class="line">  <span class="keyword">if</span> (dataLocations != <span class="keyword">null</span>) {</span><br><span class="line">      <span class="comment">// &#x5BF9;&#x4E8E;&#x6570;&#x636E;&#x6587;&#x4EF6;&#x4F4D;&#x7F6E;&#x5217;&#x8868;&#x505A;&#x904D;&#x5386;</span></span><br><span class="line">      <span class="keyword">for</span> (Path dataLocation : dataLocations) {</span><br><span class="line">          <span class="keyword">final</span> Path stateDir = dataLocation.resolve(STATE_DIR_NAME);</span><br><span class="line">          <span class="keyword">try</span> (DirectoryStream&lt;Path&gt; paths = Files.newDirectoryStream(stateDir)) {</span><br><span class="line">              <span class="keyword">for</span> (Path stateFile : paths) {</span><br><span class="line">                  <span class="comment">// &#x7B5B;&#x9009;&#x72B6;&#x6001;&#x6587;&#x4EF6;</span></span><br><span class="line">                  <span class="keyword">final</span> Matcher matcher = stateFilePattern.matcher(stateFile.getFileName().toString());</span><br><span class="line">                  <span class="keyword">if</span> (matcher.matches()) {</span><br><span class="line">                      <span class="keyword">final</span> <span class="keyword">long</span> stateId = Long.parseLong(matcher.group(<span class="number">1</span>));</span><br><span class="line">                      maxStateId = Math.max(maxStateId, stateId);</span><br><span class="line">                      <span class="keyword">final</span> <span class="keyword">boolean</span> legacy = MetaDataStateFormat.STATE_FILE_EXTENSION.equals(matcher.group(<span class="number">2</span>)) == <span class="keyword">false</span>;</span><br><span class="line">                      maxStateIdIsLegacy &amp;= legacy;</span><br><span class="line">                      PathAndStateId pav = <span class="keyword">new</span> PathAndStateId(stateFile, stateId, legacy);</span><br><span class="line">                      logger.trace(<span class="string">&quot;found state file: {}&quot;</span>, pav);</span><br><span class="line">                      <span class="comment">// &#x52A0;&#x5165;&#x6587;&#x4EF6;&#x5217;&#x8868;</span></span><br><span class="line">                      files.add(pav);</span><br><span class="line">                  }</span><br><span class="line">              }</span><br><span class="line">          } <span class="keyword">catch</span> (NoSuchFileException | FileNotFoundException ex) {</span><br><span class="line">              <span class="comment">// no _state directory -- move on</span></span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">final</span> List&lt;Throwable&gt; exceptions = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  T state = <span class="keyword">null</span>;</span><br><span class="line">  <span class="comment">// &#x7B5B;&#x9009;&#x51FA;&#x6700;&#x5927;&#x7248;&#x672C;&#x53F7;&#x7684;&#x6700;&#x65B0;&#x7D22;&#x5F15;&#x6587;&#x4EF6;</span></span><br><span class="line">  Collection&lt;PathAndStateId&gt; pathAndStateIds = files</span><br><span class="line">          .stream()</span><br><span class="line">          .filter(<span class="keyword">new</span> StateIdAndLegacyPredicate(maxStateId, maxStateIdIsLegacy))</span><br><span class="line">          .collect(Collectors.toCollection(ArrayList::<span class="keyword">new</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (PathAndStateId pathAndStateId : pathAndStateIds) {</span><br><span class="line">      <span class="keyword">try</span> {</span><br><span class="line">          <span class="keyword">final</span> Path stateFile = pathAndStateId.file;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">long</span> id = pathAndStateId.id;</span><br><span class="line">          <span class="keyword">if</span> (pathAndStateId.legacy) {</span><br><span class="line">              <span class="comment">// &#x65E7;&#x7248;&#x683C;&#x5F0F;</span></span><br><span class="line">              <span class="keyword">final</span> <span class="keyword">byte</span>[] data = Files.readAllBytes(stateFile);</span><br><span class="line">              <span class="keyword">if</span> (data.length == <span class="number">0</span>) {</span><br><span class="line">                  logger.debug(<span class="string">&quot;{}: no data for [{}], ignoring...&quot;</span>, prefix, stateFile.toAbsolutePath());</span><br><span class="line">                  <span class="keyword">continue</span>;</span><br><span class="line">              }</span><br><span class="line">              <span class="comment">// &#x89E3;&#x6790;&#x6587;&#x4EF6;&#x5185;&#x5BB9;</span></span><br><span class="line">              <span class="keyword">try</span> (XContentParser parser = XContentHelper.createParser(namedXContentRegistry, <span class="keyword">new</span> BytesArray(data))) {</span><br><span class="line">                  state = fromXContent(parser);</span><br><span class="line">              }</span><br><span class="line">              <span class="keyword">if</span> (state == <span class="keyword">null</span>) {</span><br><span class="line">                  logger.debug(<span class="string">&quot;{}: no data for [{}], ignoring...&quot;</span>, prefix, stateFile.toAbsolutePath());</span><br><span class="line">              }</span><br><span class="line">          } <span class="keyword">else</span> {</span><br><span class="line">              <span class="comment">// &#x6700;&#x65B0;&#x7248;&#x672C;&#x683C;&#x5F0F;&#x8BFB;&#x53D6;</span></span><br><span class="line">              state = read(namedXContentRegistry, stateFile);</span><br><span class="line">              logger.trace(<span class="string">&quot;state id [{}] read from [{}]&quot;</span>, id, stateFile.getFileName());</span><br><span class="line">          }</span><br><span class="line">          <span class="keyword">return</span> state;</span><br><span class="line">      } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">          exceptions.add(<span class="keyword">new</span> IOException(<span class="string">&quot;failed to read &quot;</span> + pathAndStateId.toString(), e));</span><br><span class="line">          logger.debug(</span><br><span class="line">              (Supplier&lt;?&gt;) () -&gt; <span class="keyword">new</span> ParameterizedMessage(</span><br><span class="line">                  <span class="string">&quot;{}: failed to read [{}], ignoring...&quot;</span>, pathAndStateId.file.toAbsolutePath(), prefix), e);</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>&#x5728;&#x65B9;&#x6CD5;<code>read</code>&#x5185;&#x4F1A;&#x89E3;&#x6790;&#x771F;&#x6B63;&#x7684;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x3002;</p><h4 id="ES&#x805A;&#x5408;&#x67E5;&#x8BE2;&#x6D41;&#x7A0B;"><a href="#ES&#x805A;&#x5408;&#x67E5;&#x8BE2;&#x6D41;&#x7A0B;" class="headerlink" title="ES&#x805A;&#x5408;&#x67E5;&#x8BE2;&#x6D41;&#x7A0B;"></a>ES&#x805A;&#x5408;&#x67E5;&#x8BE2;&#x6D41;&#x7A0B;</h4><p>ES&#x6BCF;&#x4E00;&#x6B21;&#x67E5;&#x8BE2;&#x901A;&#x8FC7;<code>netty</code>&#x670D;&#x52A1;&#x4F20;&#x9012;&#x67E5;&#x8BE2;&#x547D;&#x4EE4;&#xFF0C;&#x4EE5;&#x4E0B;&#x662F;&#x805A;&#x5408;&#x67E5;&#x8BE2;&#x6D41;&#x7A0B;&#xFF1A;</p><pre class="mermaid">sequenceDiagram;
  Netty4HttpRequestHandler-&gt;&gt;Netty4HttpRequestHandler: &#x8BFB;&#x53D6;&#x6570;&#x636E;
  Netty4HttpRequestHandler-&gt;&gt;Netty4HttpServerTransport: &#x4F20;&#x8F93;&#x8BF7;&#x6C42;
  Netty4HttpServerTransport-&gt;&gt;RestController: &#x5206;&#x53D1;&#x8BF7;&#x6C42;
  RestController-&gt;&gt;RestController: &#x904D;&#x5386;&#x6240;&#x6709;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x67E5;&#x627E;&#x5339;&#x914D;&#x7684;handler
  alt &#x67E5;&#x627E;&#x5230;&#x5339;&#x914D;&#x7684;:
    RestController-&gt;&gt;BaseRestHandler: &#x5904;&#x7406;&#x8BF7;&#x6C42;
    BaseRestHandler-&gt;&gt;RestSearchAction: &#x89E3;&#x6790;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x5177;&#x4F53;&#x7684;&#x5904;&#x7F6E;&#x52A8;&#x4F5C;
    RestSearchAction-&gt;&gt;SearchSourceBuilder: &#x6839;&#x636E;&#x4F20;&#x9012;&#x8FC7;&#x6765;&#x7684;json&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x6790;&#x8BF7;&#x6C42;&#x5185;&#x5BB9;
    SearchSourceBuilder-&gt;&gt;SearchSourceBuilder: &#x6839;&#x636E;string token&#xFF0C;&#x5224;&#x65AD;&#x4E0D;&#x540C;&#x7C7B;&#x578B;&#xFF0C;&#x89E3;&#x6790;&#x4E0D;&#x540C;&#x7684;&#x6570;&#x636E;
    SearchSourceBuilder-&gt;&gt;AggregatorFactories: &#x4ECE;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x6784;&#x5EFA;&#x51FA;&#x805A;&#x5408;&#x5DE5;&#x5382;&#x7528;&#x4E8E;&#x540E;&#x7EED;&#x6784;&#x5EFA;&#x805A;&#x5408;
    AggregatorFactories-&gt;&gt;AggregatorFactories: &#x6784;&#x5EFA;&#x805A;&#x5408;&#x5DE5;&#x5382;
    AggregatorFactories-&gt;&gt;SearchSourceBuilder: &#x7EE7;&#x7EED;&#x89E3;&#x6790;&#x5176;&#x4ED6;&#x5185;&#x5BB9;
    SearchSourceBuilder-&gt;&gt;RestSearchAction: &#x89E3;&#x6790;&#x5B8C;&#x6210;
    RestSearchAction-&gt;&gt;RestSearchAction: &#x89E3;&#x6790;&#x67E5;&#x8BE2;&#x7C7B;&#x578B;&#x3001;&#x8DEF;&#x7531;&#x3001;&#x7D22;&#x5F15;&#x9009;&#x9879;&#x4EE5;&#x53CA;&#x6DF1;&#x5EA6;&#x5206;&#x9875;&#x8BF7;&#x6C42;&#x4FE1;&#x606F;&#x7B49;&#x7B49;
    RestSearchAction-&gt;&gt;BaseRestHandler: &#x8FD4;&#x56DE;&#x9884;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x7684;Action
    alt: &#x5B58;&#x5728;&#x6709;&#x53C2;&#x6570;&#x672A;&#x5904;&#x7406;
      BaseRestHandler-&gt;&gt;BaseRestHandler: &#x629B;&#x51FA;&#x5F02;&#x5E38;
    end
    BaseRestHandler-&gt;&gt;BaseRestHandler: &#x4F7F;&#x7528;&#x8BA1;&#x6570;+1
    BaseRestHandler-&gt;&gt;RestSearchAction: &#x5C06;&#x8BF7;&#x6C42;&#x4EA4;&#x7531;RestSearchAction&#x5904;&#x7406;
    RestSearchAction-&gt;&gt;TransportSearchAction: &#x67E5;&#x8BE2;action&#x4EA4;&#x7531;&#x5177;&#x4F53;Transport&#x6267;&#x884C;
    TransportSearchAction-&gt;&gt;TransportSearchAction: &#x6839;&#x636E;state&#x4EE5;&#x53CA;&#x8BF7;&#x6C42;&#x83B7;&#x53D6;&#x5177;&#x4F53;&#x7684;&#x7D22;&#x5F15;
    TransportSearchAction-&gt;&gt;TransportSearchAction: &#x9884;&#x5904;&#x7406;&#x522B;&#x540D;
    TransportSearchAction-&gt;&gt;TransportSearchAction: &#x67E5;&#x8BE2;&#x8BF7;&#x6C42;&#x8DEF;&#x7531;
    TransportSearchAction-&gt;&gt;TransportSearchAction: &#x83B7;&#x53D6;&#x7D22;&#x5F15;&#x5728;&#x6240;&#x6709;shards&#x4E0A;&#x7684;&#x904D;&#x5386;&#x5668;
    TransportSearchAction-&gt;&gt;AbstractSearchAsyncAction: &#x5F02;&#x6B65;&#x67E5;&#x8BE2;&#x89E3;&#x6790;
    AbstractSearchAsyncAction-&gt;&gt;InitialSearchPhase: &#x6267;&#x884C;&#x5F02;&#x6B65;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;
    InitialSearchPhase-&gt;&gt;InitialSearchPhase: &#x5206;&#x7247;&#x904D;&#x5386;&#x5E76;&#x5728;&#x6BCF;&#x4E2A;&#x5206;&#x7247;&#x4E0A;&#x6267;&#x884C;&#x67E5;&#x8BE2;
    InitialSearchPhase-&gt;&gt;SearchQueryThenFetchAsyncAction: &#x4F20;&#x9012;&#x5206;&#x7247;&#x4FE1;&#x606F;&#x4EE5;&#x53CA;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;
    SearchQueryThenFetchAsyncAction-&gt;&gt;TransportService: &#x5C06;&#x67E5;&#x8BE2;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x4EA4;&#x7531;Transport&#x670D;&#x52A1;&#x6765;&#x6267;&#x884C;
    TransportService-&gt;&gt;TransportService: &#x4EA4;&#x7531;localNodeConnection&#x6267;&#x884C;&#x67E5;&#x8BE2;&#x8BF7;&#x6C42;
    TransportService-&gt;&gt;SearchTransportService: &#x5C06;&#x8BF7;&#x6C42;&#x4F20;&#x9012;
    SearchTransportService-&gt;&gt;SearchService: &#x6267;&#x884C;searchService&#x8BF7;&#x6C42;&#x67E5;&#x8BE2;&#x4F20;&#x5165;&#x8BF7;&#x6C42;&#x4EE5;&#x53CA;&#x56DE;&#x8C03;&#x76D1;&#x542C;
    SearchService-&gt;&gt;SearchService: &#x6267;&#x884C;&#x67E5;&#x8BE2;&#x89E3;&#x6790;&#x5E76;&#x67E5;&#x8BE2;&#x5177;&#x4F53;&#x7ED3;&#x679C;
    SearchService-&gt;&gt;QueryPhase: &#x67E5;&#x8BE2;&#x89E3;&#x6790;
    QueryPhase&#x2014;&gt;&gt;AggregationPhase: &#x805A;&#x5408;&#x9884;&#x5904;&#x7406;&#xFF0C;&#x6784;&#x5EFA;&#x9876;&#x5C42;&#x805A;&#x5408;
    AggregationPhase-&gt;&gt;QueryPhase: &#x9884;&#x5904;&#x7406;&#x5B8C;&#x6210;
    QueryPhase-&gt;&gt;QueryPhase: &#x805A;&#x5408;&#x8BED;&#x53E5;&#x6267;&#x884C;
    QueryPhase&#x2014;&gt;&gt;QueryPhase: &#x8FD4;&#x56DE;&#x6267;&#x884C;&#x7ED3;&#x679C;
    QueryPhase-&gt;&gt;SearchService: &#x7ED3;&#x679C;&#x8FD4;&#x56DE;</pre><p>&#x4E0A;&#x8FF0;&#x7684;&#x6574;&#x4E2A;&#x6D41;&#x7A0B;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6709;&#x4E09;&#x5904;&#x5730;&#x65B9;&#x5BF9;&#x4E8E;&#x805A;&#x5408;&#x505A;&#x4E86;&#x5904;&#x7406;&#xFF1A;</p><ol><li>&#x8BF7;&#x6C42;&#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x6790;&#x51FA;&#x805A;&#x5408;&#x6784;&#x5EFA;&#x5668;</li><li>&#x9884;&#x5904;&#x7406;&#x805A;&#x5408;&#x6784;&#x5EFA;&#x5668;&#xFF0C;&#x6784;&#x5EFA;&#x51FA;top&#x805A;&#x5408;</li><li>&#x805A;&#x5408;&#x8BED;&#x53E5;&#x6267;&#x884C;</li></ol><p>&#x8FD9;&#x4E09;&#x5904;&#x5730;&#x65B9;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5BF9;&#x4E8E;&#x805A;&#x5408;&#x5B57;&#x6BB5;&#x505A;&#x7279;&#x6B8A;&#x5224;&#x65AD;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x805A;&#x5408;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x76F4;&#x63A5;&#x9009;&#x62E9;keyword&#x5C5E;&#x6027;&#x3002;&#x800C;&#x662F;&#x9700;&#x8981;&#x5728;&#x8BF7;&#x6C42;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x663E;&#x793A;&#x6307;&#x5B9A;&#x5B57;&#x6BB5;&#x7C7B;&#x578B;&#x4E3A;keyword&#x7C7B;&#x578B;&#x7684;&#x6807;&#x8BC6;&#x3002;</p><h3 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h3><p>&#x5982;&#x679C;&#x9700;&#x8981;&#x5728;&#x805A;&#x5408;&#x7684;&#x65F6;&#x5019;&#x76F4;&#x63A5;&#x4F7F;&#x7528;keyword&#xFF0C;&#x5219;&#x663E;&#x793A;&#x6307;&#x5B9A;&#x5B83;&#x3002;</p><script>document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });</script></div></div><div class="article-copyright"><div class="copyright"><p><span>本文标题:</span><a href="/how-es-choose-and-get-filed-info.html">ES查询中如何获取并解析查询字段</a></p><p><span>文章作者:</span><a href="/" title="访问 WhatAKitty 的个人博客">WhatAKitty</a></p><p><span>发布时间:</span>2019年10月03日 - 00时22分</p><p><span>最后更新:</span>2019年10月03日 - 23时00分</p><p><span>原始链接:</span><a href="/how-es-choose-and-get-filed-info.html" title="ES查询中如何获取并解析查询字段">https://xuqiang.me/how-es-choose-and-get-filed-info.html</a> <span class="btn" data-clipboard-text="原文: https://xuqiang.me/how-es-choose-and-get-filed-info.html　　作者: WhatAKitty" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。</p></div><br><br><style type="text/css">.copyright p .btn{margin-left:1em}.copyright:hover p .btn::after{content:"复制"}.copyright p .btn:hover{color:gray;cursor:pointer}</style></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/Java/">Java</a>, <a href="/categories/Java/Elasticsearch/">Elasticsearch</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/java/">java</a><a href="/tags/es/">es</a><a href="/tags/field/">field</a></span></div><script src="https://cdn.staticfile.org/mermaid/8.0.0/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"},".mermaid")</script><div class="article-meta pull-right"><span style="display:inline-block;width:83px"><a style="float:left;text-decoration:none" target="_blank" href="https://www.banquanyin.com/u/101709260007755"><img src="https://s1.banquanyin.com/c/icon-yin-24.png" title="更多授权" style="width:inherit"> </a><a target="_blank" href="https://101709260007755.bqy.mobi"><img src="https://s1.banquanyin.com/c/icon-auth-cr-24.png" title="获取授权" style="width:inherit"></a></span></div></div><div style="text-align:center;margin-top:80px"><div id="cyReward" role="cylabs" data-use="reward" sid="188f777835a81be3259c6dc0b28cc029" cid="1"></div></div></article><div id="SOHUCS" sid="188f777835a81be3259c6dc0b28cc029"></div><script type="text/javascript">!function(){var e,t,n,a="cytdcyLLd",c="1243e90ae1a56c027241ecf5b99daeda";(window.innerWidth||document.documentElement.clientWidth)<960?window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+a+"&conf="+c+'"><\/script>'):(e=function(){window.changyan.api.config({appid:a,conf:c})},t=document.getElementsByTagName("head")[0]||document.head||document.documentElement,(n=document.createElement("script")).setAttribute("type","text/javascript"),n.setAttribute("charset","UTF-8"),n.setAttribute("src","https://changyan.sohu.com/upload/changyan.js"),window.attachEvent?n.onreadystatechange=function(){var t=n.readyState;"loaded"!==t&&"complete"!==t||(n.onreadystatechange=null,e())}:n.onload=e,t.appendChild(n))}()</script><script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script><script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cytdcyLLd"></script></main><footer class="site-footer"><script async src="//static.xuqiang.me/busuanzi.pure.mini.js"></script><p class="site-info">Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a><br>&copy; 2019 WhatAKitty | <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><br><a href="https://blog.whatakitty.com">浙ICP备15019585号</a> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602008839" style="display:block;line-height:20px"><span style="display:inline-block;line-height:20px;vertical-align:middle"><img src="https://static.xuqiang.me/public/images/beian.png" style="width:20px;height:20px"></span><span style="display:inline-block;height:20px;line-height:20px;margin:0 0 0 5px">浙公网安备 33010602008839号</span></a></p></footer><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?1d4c4cd810512d2fddb7187b7939389a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></div></body></html>
