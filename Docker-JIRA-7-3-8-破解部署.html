<!DOCTYPE HTML><html><head><meta charset="utf-8"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Docker JIRA 7.3.8 破解部署 | WhatAKitty Daily | A Programmer&#39;s Daily Record</title><meta name="author" content="WhatAKitty"><meta name="description" content="Just A Simple Programmer."><meta name="keywords" content="Docker,JIRA,破解,持续开发集成环境,Dockerfile,Blog, SSL, Nodejs, DevOps, Spring, Spring Cloud, Jenkins, Docker, JIRA, CI"><meta id="viewport" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:title" content="Docker JIRA 7.3.8 破解部署"><meta property="og:site_name" content="WhatAKitty Daily"><meta property="og:image" content="/favicon.ico"><link href="/favicon.ico" rel="icon"><link rel="alternate" href="/atom.xml" title="WhatAKitty Daily" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">WhatAKitty Daily</a></h1><p class="site-description">A Programmer&#39;s Daily Record</p></div><nav class="site-navigation"><ul><li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/projects">项目</a></li><li><a href="/atom.xml">订阅</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class="article-title"><span>Docker JIRA 7.3.8 破解部署</span></h3><div class="article-top-meta"><span class="posted-on"><a href="/Docker-JIRA-7-3-8-破解部署.html" rel="bookmark">WhatAKitty &emsp; <time class="entry-date published" datetime="2017-08-28T18:00:00.000Z">2017-08-29</time></a></span></div><div class="article-content"><div class="entry"><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>最近在做devOps自动化集成部署的事情，在比较了多款issue tracker后，还是决定使用JIRA。因为相对于其他软件来说，它的功能更强大、更完善。不过很不幸的是，JIRA的使用需要商业授权而且费用相当高昂，对于我们这种小公司来说，只能使用破解版本了。</p><h3 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h3><ul><li>Doker CE</li></ul><p>如何安装docker，在这里就不做描述了</p><a id="more"></a><h3 id="改写Dockerfile"><a href="#改写Dockerfile" class="headerlink" title="改写Dockerfile"></a>改写Dockerfile</h3><p>网上有相对符合我需求的现成Dockerfile两种：</p><ul><li><a href="https://github.com/idoall/docker/tree/master/jira" target="_blank" rel="noopener">https://github.com/idoall/docker/tree/master/jira</a></li><li><a href="https://github.com/cptactionhank/docker-atlassian-jira" target="_blank" rel="noopener">https://github.com/cptactionhank/docker-atlassian-jira</a></li></ul><p>第一种版本有点旧（7.2.7的版本，破解补丁已经有7.3的版本了），曾经尝试在这种版本上做直接调整，发现层出不穷的问题，果断放弃。<br>第二种版本是最新的（7.4.x的版本，但是破解补丁没有这么新），而且只是jira-core的版本，不是jira-software的版本，不符合我的要求，因此需要对这个版本做修改。</p><h4 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/cptactionhank/docker-atlassian-jira.git</span><br><span class="line"></span><br><span class="line">cd docker-atlassian-jira</span><br></pre></td></tr></table></figure>
<p>编辑Dockerfile文件：<br></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Configuration variables.</span></span><br><span class="line"><span class="keyword">ENV</span> JIRA_HOME     /var/atlassian/jira</span><br><span class="line"><span class="keyword">ENV</span> JIRA_INSTALL  /opt/atlassian/jira</span><br><span class="line"><span class="keyword">ENV</span> JIRA_VERSION  <span class="number">7.3</span>.<span class="number">8</span></span><br><span class="line"><span class="comment"># 定义临时文件夹，用于存放上传的文件</span></span><br><span class="line"><span class="keyword">ENV</span> TEMP_PATH     /temp/jira</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备JIRA的安装工作</span></span><br><span class="line"><span class="comment"># 1. 创建/temp/jira临时目录</span></span><br><span class="line"><span class="comment"># 2. 将需要的文件上传到临时文件，有破解文件和JIRA的安装包等等</span></span><br><span class="line"><span class="comment"># 3. 将sources.list.163文件上传，用于替换成163源</span></span><br><span class="line"><span class="comment"># To Ready JIRA</span></span><br><span class="line"><span class="keyword">RUN</span> mkdir /temp &amp;&amp; mkdir /temp/jira</span><br><span class="line">COPY mysql-connector-java-5.1.39-bin.jar         /temp/jira/mysql-connector-java-5.1.39-bin.jar</span><br><span class="line">COPY atlassian-extras-3.2.jar                    /temp/jira/atlassian-extras-3.2.jar</span><br><span class="line">COPY postgresql-9.4.1212.jar                     /temp/jira/postgresql-9.4.1212.jar</span><br><span class="line">COPY atlassian-jira-software-7.3.8.tar.gz        /temp/jira/atlassian-jira-software-7.3.8.tar.gz</span><br><span class="line">COPY sources.list.163                            /temp/jira/sources.list.163</span><br><span class="line"></span><br><span class="line"># 安装JIRA的运行命令，主要做了以下工作：</span><br><span class="line"># 1. 将debain的原始源替换成国内的163源</span><br><span class="line"># 2. 将下载获取JIRA更换为上传JIRA的源码包，因为下载JIRA的速度实在有点感人</span><br><span class="line"># Install Atlassian JIRA and helper tools and setup initial home</span><br><span class="line"># directory structure.</span><br><span class="line">RUN set -x \</span><br><span class="line">    &amp;&amp; mv                      /etc/apt/sources.list /etc/apt/sources.list.back \</span><br><span class="line">    &amp;&amp; cp                      "$&#123;TEMP_PATH&#125;/sources.list.163" /etc/apt/sources.list \</span><br><span class="line">    # &amp;&amp; echo "deb http://mirrors.163.com/debian jessie-backports main" &gt; /etc/apt/sources.list.d/jessie-backports.list \</span><br><span class="line">    &amp;&amp; apt-get update --quiet \</span><br><span class="line">    &amp;&amp; apt-get install --quiet --yes --no-install-recommends xmlstarlet \</span><br><span class="line">    &amp;&amp; apt-get install --quiet --yes --no-install-recommends -t jessie-backports libtcnative-1 \</span><br><span class="line">    &amp;&amp; apt-get clean \</span><br><span class="line">    &amp;&amp; mkdir -p                "$&#123;JIRA_HOME&#125;" \</span><br><span class="line">    &amp;&amp; mkdir -p                "$&#123;JIRA_HOME&#125;/caches/indexes" \</span><br><span class="line">    &amp;&amp; chmod -R 700            "$&#123;JIRA_HOME&#125;" \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  "$&#123;JIRA_HOME&#125;" \</span><br><span class="line">    &amp;&amp; mkdir -p                "$&#123;JIRA_INSTALL&#125;/conf/Catalina" \</span><br><span class="line">    &amp;&amp; cp                      "$&#123;TEMP_PATH&#125;/atlassian-jira-software-$&#123;JIRA_VERSION&#125;.tar.gz" "./atlassian-jira-software-$&#123;JIRA_VERSION&#125;.tar.gz" \</span><br><span class="line">    &amp;&amp; tar -zxvf               "./atlassian-jira-software-$&#123;JIRA_VERSION&#125;.tar.gz" --directory "$&#123;JIRA_INSTALL&#125;" --strip-components=1 --no-same-owner \</span><br><span class="line">    &amp;&amp; curl -Ls                "https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.38.tar.gz" | tar -xz --directory "$&#123;JIRA_INSTALL&#125;/lib" --strip-components=1 --no-same-owner "mysql-connector-java-5.1.38/mysql-connector-java-5.1.38-bin.jar" \</span><br><span class="line">    &amp;&amp; rm -f                   "$&#123;JIRA_INSTALL&#125;/lib/postgresql-9.1-903.jdbc4-atlassian-hosted.jar" \</span><br><span class="line">    &amp;&amp; curl -Ls                "https://jdbc.postgresql.org/download/postgresql-9.4.1212.jar" -o "$&#123;JIRA_INSTALL&#125;/lib/postgresql-9.4.1212.jar" \</span><br><span class="line">    &amp;&amp; chmod -R 700            "$&#123;JIRA_INSTALL&#125;/conf" \</span><br><span class="line">    &amp;&amp; chmod -R 700            "$&#123;JIRA_INSTALL&#125;/logs" \</span><br><span class="line">    &amp;&amp; chmod -R 700            "$&#123;JIRA_INSTALL&#125;/temp" \</span><br><span class="line">    &amp;&amp; chmod -R 700            "$&#123;JIRA_INSTALL&#125;/work" \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  "$&#123;JIRA_INSTALL&#125;/conf" \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  "$&#123;JIRA_INSTALL&#125;/logs" \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  "$&#123;JIRA_INSTALL&#125;/temp" \</span><br><span class="line">    &amp;&amp; chown -R daemon:daemon  "$&#123;JIRA_INSTALL&#125;/work" \</span><br><span class="line">    &amp;&amp; sed --in-place          "s/java version/openjdk version/g" "$&#123;JIRA_INSTALL&#125;/bin/check-java.sh" \</span><br><span class="line">    &amp;&amp; echo -e                 "\njira.home=$JIRA_HOME" &gt;&gt; "$&#123;JIRA_INSTALL&#125;/atlassian-jira/WEB-INF/classes/jira-application.properties" \</span><br><span class="line">    &amp;&amp; touch -d "@0"           "$&#123;JIRA_INSTALL&#125;/conf/server.xml"</span><br><span class="line"></span><br><span class="line"># 使用补丁包替换掉原来的JAR包</span><br><span class="line"># Hack</span><br><span class="line">RUN set -x \</span><br><span class="line">    &amp;&amp; rm -rf                  "$&#123;JIRA_INSTALL&#125;/atlassian-jira/WEB-INF/lib/atlassian-extras-3.2.jar" \</span><br><span class="line">    &amp;&amp; cp                      "$&#123;TEMP_PATH&#125;/atlassian-extras-3.2.jar" "$&#123;JIRA_INSTALL&#125;/atlassian-jira/WEB-INF/lib/atlassian-extras-3.2.jar"</span><br><span class="line"></span><br><span class="line"># Use the default unprivileged account. This could be considered bad practice</span><br><span class="line"># on systems where multiple processes end up being executed by 'daemon' but</span><br><span class="line"># here we only ever run one process anyway.</span><br><span class="line">USER daemon:daemon</span><br><span class="line"></span><br><span class="line"># Expose default HTTP connector port.</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"># Set volume mount points for installation and home directory. Changes to the</span><br><span class="line"># home directory needs to be persisted as well as parts of the installation</span><br><span class="line"># directory due to eg. logs.</span><br><span class="line">VOLUME ["/var/atlassian/jira", "/opt/atlassian/jira/logs"]</span><br><span class="line"></span><br><span class="line"># Set the default working directory as the installation directory.</span><br><span class="line">WORKDIR /var/atlassian/jira</span><br><span class="line"></span><br><span class="line">COPY "docker-entrypoint.sh" "/"</span><br><span class="line">ENTRYPOINT ["/docker-entrypoint.sh"]</span><br><span class="line"></span><br><span class="line"># Run Atlassian JIRA as a foreground process by default.</span><br><span class="line">CMD ["/opt/atlassian/jira/bin/catalina.sh", "run"]</span><br></pre></td></tr></table></figure><p></p>
<h4 id="构建image"><a href="#构建image" class="headerlink" title="构建image"></a>构建image</h4><p>现在已经有了线程的Dockerfile，那么久可以直接上手构建镜像了：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t local-jira:7.3.8 .</span><br></pre></td></tr></table></figure><p></p>
<p>注意不要遗漏最后一个“.”，这个是用来指定目标Dockerfile文件的所在文件夹。</p>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p>构建完成镜像，我们现在可以根据镜像直接运行jira：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --publish 8080:8080 --name jira -d local-jira:7.3.8</span><br></pre></td></tr></table></figure><p></p>
<p>可以看到，容器已经完美运行：<br><img src="https://static.xuqiang.me/public/images/pasted-1.png" alt="upload successful"></p>
<p><img src="https://static.xuqiang.me/public/images/pasted-2.png" alt="upload successful"></p>
<p>提醒：在第一个界面的右上角，可以直接更改为中文（默认英文）</p>
<h3 id="生产环境数据库"><a href="#生产环境数据库" class="headerlink" title="生产环境数据库"></a>生产环境数据库</h3><p>不要着急，如果是正式部署在生产环境上的，如果使用内置数据库，总感觉有点不保险，JIRA也建议如果部署在生产环境上的话，直接使用外部数据库，因此我们只需要在docker容器上启动一个数据库即可：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run --name jira-mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=ROOT_PASSWORD \</span><br><span class="line">-e MYSQL_DATABASE=JIRA_DATABASENAME \</span><br><span class="line">-e MYSQL_USER= JIRA_USER\</span><br><span class="line">-e MYSQL_PASSWORD=JIRA_PASSWORD \</span><br><span class="line">-d mysql:latest \</span><br><span class="line">--character-set-server=utf8mb4 \</span><br><span class="line">--collation-server=utf8mb4_bin</span><br></pre></td></tr></table></figure><p></p>
<h3 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h3><p>有了数据库后，直接在jira配置的时候，使用外部数据库连接就行了。</p>
      
    </div>

  </div>

  
  <div class="article-copyright">
      <div class="copyright"><p><span>本文标题:</span><a href="/Docker-JIRA-7-3-8-破解部署.html">Docker JIRA 7.3.8 破解部署</a></p><p><span>文章作者:</span><a href="/" title="访问 WhatAKitty 的个人博客">WhatAKitty</a></p><p><span>发布时间:</span>2017年08月29日 - 02时00分</p><p><span>最后更新:</span>2017年11月11日 - 16时57分</p><p><span>原始链接:</span><a href="/Docker-JIRA-7-3-8-破解部署.html" title="Docker JIRA 7.3.8 破解部署">https://xuqiang.me/Docker-JIRA-7-3-8-破解部署.html</a> <span class="btn" data-clipboard-text="原文: https://xuqiang.me/Docker-JIRA-7-3-8-破解部署.html　　作者: WhatAKitty" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。</p></div><br><br><style type="text/css">.copyright p .btn{margin-left:1em}.copyright:hover p .btn::after{content:"复制"}.copyright p .btn:hover{color:gray;cursor:pointer}</style>
  </div>
  

  

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Docker/">Docker</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Docker/">Docker</a><a href="/tags/JIRA/">JIRA</a><a href="/tags/破解/">破解</a><a href="/tags/持续开发集成环境/">持续开发集成环境</a><a href="/tags/Dockerfile/">Dockerfile</a>
    </span>
    

    </div>

    
    <div class="article-meta pull-right">
      <span style="display:inline-block;width:83px">
        <a style="float:left;text-decoration:none" target="_blank" href="https://www.banquanyin.com/u/101709260007755">
          <img src="https://s1.banquanyin.com/c/icon-yin-24.png" title="更多授权" style="width:inherit">
        </a>
        <a target="_blank" href="https://101709260007755.bqy.mobi">
          <img src="https://s1.banquanyin.com/c/icon-auth-cr-24.png" title="获取授权" style="width:inherit">
        </a>
      </span>
    </div>
    

    
  </div>

  
    <div style="text-align:center;margin-top:80px">
      <div id="cyReward" role="cylabs" data-use="reward" sid="a64414f641aaa17005da442a737c9d8d" cid="1"></div>
    </div>
  

</article>


  <div id="SOHUCS" sid="a64414f641aaa17005da442a737c9d8d"></div><script type="text/javascript">!function(){var t="1243e90ae1a56c027241ecf5b99daeda";(window.innerWidth||document.documentElement.clientWidth)<960?window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=cytdcyLLd&conf='+t+'"><\/script>'):function(t,e){var n=document.getElementsByTagName("head")[0]||document.head||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("charset","UTF-8"),a.setAttribute("src","https://changyan.sohu.com/upload/changyan.js"),"function"==typeof e&&(window.attachEvent?a.onreadystatechange=function(){var t=a.readyState;"loaded"!==t&&"complete"!==t||(a.onreadystatechange=null,e())}:a.onload=e),n.appendChild(a)}(0,function(){window.changyan.api.config({appid:"cytdcyLLd",conf:t})})}()</script><script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script><script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cytdcyLLd"></script>
    </main>

    <footer class="site-footer"><p class="site-info">Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a><br>&copy; 2018 WhatAKitty<br><a href="https://blog.whatakitty.com">浙ICP备15019585号</a> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602008839" style="display:block;line-height:20px"><span style="display:inline-block;line-height:20px;vertical-align:middle"><img src="https://static.xuqiang.me/public/images/beian.png" style="width:20px;height:20px"></span><span style="display:inline-block;height:20px;line-height:20px;margin:0 0 0 5px">浙公网安备 33010602008839号</span></a></p></footer>
    
    <script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?1d4c4cd810512d2fddb7187b7939389a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></div></body></html>
