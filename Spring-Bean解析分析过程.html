<!DOCTYPE HTML><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Spring @Bean解析分析过程 | WhatAKitty Daily | A Programmer&#39;s Daily Record</title><meta name="author" content="WhatAKitty"><meta name="description" content="Just A Simple Programmer."><meta name="keywords" content="bean,bean覆盖,java,Spring,Spring5,CGLIB,AspectJ,bean post,AOP,Blog, SSL, Nodejs, DevOps, Spring, Spring Cloud, Jenkins, Docker, JIRA, CI"><meta id="viewport" name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta property="og:title" content="Spring @Bean解析分析过程"><meta property="og:site_name" content="WhatAKitty Daily"><meta property="og:image" content="/favicon.ico"><link href="/favicon.ico" rel="icon"><link rel="alternate" href="/atom.xml" title="WhatAKitty Daily" type="application/atom+xml"><link rel="stylesheet" href="/css/style.css" media="screen" type="text/css"></head><body><div class="blog"><div class="content"><header><div class="site-branding"><h1 class="site-title"><a href="/">WhatAKitty Daily</a></h1><p class="site-description">A Programmer&#39;s Daily Record</p></div><nav class="site-navigation"><ul><li><a href="/">主页</a></li><li><a href="/archives">归档</a></li><li><a href="/projects">项目</a></li><li><a href="/categories/JavaSources">Java Sources</a></li><li><a href="/categories/Java/Spring/SpringSources">Spring Sources</a></li><li><a href="/atom.xml">订阅</a></li></ul></nav></header><main class="site-main posts-loop"><article><h3 class="article-title"><span>Spring @Bean解析分析过程</span></h3><div class="article-top-meta"><span class="posted-on"><a href="/Spring-Bean解析分析过程.html" rel="bookmark">WhatAKitty &emsp; <time class="entry-date published" datetime="2018-08-23T16:35:49.000Z">2018-08-24 </time>&emsp; <span id="busuanzi_container_page_pv">阅读次数<span id="busuanzi_value_page_pv">loading...</span></span></a></span></div><div class="article-content"><div class="entry"><h3 id="&#x524D;&#x63D0;"><a href="#&#x524D;&#x63D0;" class="headerlink" title="&#x524D;&#x63D0;"></a>&#x524D;&#x63D0;</h3><ul><li>Spring 5</li><li>&#x57FA;&#x4E8E;Java Configuration&#x914D;&#x7F6E;&#xFF0C;&#x800C;&#x975E;XML&#x914D;&#x7F6E;</li><li>&#x975E;Web&#x73AF;&#x5883;</li></ul><h3 id="Bean&#x7684;&#x5904;&#x7406;"><a href="#Bean&#x7684;&#x5904;&#x7406;" class="headerlink" title="@Bean&#x7684;&#x5904;&#x7406;"></a>@Bean&#x7684;&#x5904;&#x7406;</h3><p>&#x4E0E;AOP&#x6784;&#x9020;&#x5668;&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x7C7B;&#x4F3C;&#xFF08;&#x5177;&#x4F53;&#x7684;&#x53EF;&#x4EE5;&#x67E5;&#x770B;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#xFF1A;<a href="https://xuqiang.me/&#x591A;&#x4E2A;AspectJ&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x64CD;&#x4F5C;&#x4EA7;&#x751F;&#x7684;&#x5B9E;&#x9645;&#x6548;&#x679C;&#x4EE5;&#x53CA;&#x987A;&#x5E8F;&#x60C5;&#x51B5;.html">&#x591A;&#x4E2A;AspectJ&#x5BF9;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x64CD;&#x4F5C;&#x4EA7;&#x751F;&#x7684;&#x5B9E;&#x9645;&#x6548;&#x679C;&#x4EE5;&#x53CA;&#x987A;&#x5E8F;&#x60C5;&#x51B5;</a>&#xFF09;,<code>@Bean</code>&#x7684;&#x5904;&#x7406;&#x4E5F;&#x662F;&#x5728;<code>ConfigurationClassParser</code>&#x7C7B;&#x7684;<code>doProcessConfigurationClass</code>&#x65B9;&#x6CD5;&#x5185;&#x505A;&#x7684;&#x5904;&#x7406;&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Process individual @Bean methods</span></span><br><span class="line">Set&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);</span><br><span class="line"><span class="keyword">for</span> (MethodMetadata methodMetadata : beanMethods) {</span><br><span class="line">  configClass.addBeanMethod(<span class="keyword">new</span> BeanMethod(methodMetadata, configClass));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E4B;&#x540E;&#x5728;<code>ConfigurationClassPostProcessor</code>&#x7C7B;&#x7684;<code>processConfigBeanDefinitions</code>&#x65B9;&#x6CD5;&#x5185;&#x89E3;&#x6790;&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Read the model and create bean definitions based on its content</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.reader == <span class="keyword">null</span>) {</span><br><span class="line">  <span class="keyword">this</span>.reader = <span class="keyword">new</span> ConfigurationClassBeanDefinitionReader(</span><br><span class="line">      registry, <span class="keyword">this</span>.sourceExtractor, <span class="keyword">this</span>.resourceLoader, <span class="keyword">this</span>.environment,</span><br><span class="line">      <span class="keyword">this</span>.importBeanNameGenerator, parser.getImportRegistry());</span><br><span class="line">}</span><br><span class="line"><span class="keyword">this</span>.reader.loadBeanDefinitions(configClasses);</span><br></pre></td></tr></tbody></table></figure><p></p><a id="more"></a><p><code>retrieveBeanMethodMetadata</code>&#x65B9;&#x6CD5;&#xFF0C;&#x4E3B;&#x8981;&#x662F;&#x4E3A;&#x4E86;&#x83B7;&#x53D6;<code>@Bean</code>&#x6CE8;&#x89E3;&#x7684;&#x65B9;&#x6CD5;&#x7684;&#x76F8;&#x5173;&#x5143;&#x6570;&#x636E;&#xFF0C;&#x6BD4;&#x5982;&#x65B9;&#x6CD5;&#x540D;&#x3001;&#x6240;&#x5728;&#x7C7B;&#x5168;&#x540D;&#x3001;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x3001;&#x662F;&#x5426;&#x9759;&#x6001;&#x3001;&#x662F;&#x5426;&#x4E0D;&#x53EF;&#x8986;&#x76D6;&#x7B49;&#x7B49;&#x4FE1;&#x606F;&#x3002;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Set&lt;MethodMetadata&gt; <span class="title">retrieveBeanMethodMetadata</span><span class="params">(SourceClass sourceClass)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;&#x7C7B;&#x7684;&#x5143;&#x6570;&#x636E;</span></span><br><span class="line">  AnnotationMetadata original = sourceClass.getMetadata();</span><br><span class="line">  <span class="comment">// &#x4ECE;&#x5143;&#x6570;&#x636E;&#x5185;&#x83B7;&#x53D6;&#x6CE8;&#x89E3;&#x6709;@Bean&#x7684;&#x65B9;&#x6CD5;&#x96C6;&#x5408;</span></span><br><span class="line">  Set&lt;MethodMetadata&gt; beanMethods = original.getAnnotatedMethods(Bean.class.getName());</span><br><span class="line">  <span class="comment">// &#x5224;&#x65AD;&#x65B9;&#x6CD5;&#x96C6;&#x5408;&#x662F;&#x5426;&#x8D85;&#x8FC7;&#x4E24;&#x4E2A;&#xFF0C;&#x5E76;&#x4E14;&#x7C7B;&#x7684;&#x5143;&#x6570;&#x636E;&#x662F;StandardAnnotationMetadata&#x5B9E;&#x4F8B;&#xFF0C;&#x5219;&#x4ECE;ASM&#x5185;&#x83B7;&#x53D6;&#x58F0;&#x660E;&#x7684;&#x65B9;&#x6CD5;&#x987A;&#x5E8F;</span></span><br><span class="line">  <span class="keyword">if</span> (beanMethods.size() &gt; <span class="number">1</span> &amp;&amp; original <span class="keyword">instanceof</span> StandardAnnotationMetadata) {</span><br><span class="line">    <span class="comment">// &#x5C1D;&#x8BD5;&#x901A;&#x8FC7;ASM&#x4ECE;&#x7C7B;&#x6587;&#x4EF6;&#x5224;&#x65AD;&#x65B9;&#x6CD5;&#x7684;&#x987A;&#x5E8F;...&#x56E0;&#x4E3A;&#xFF0C;JVM&#x7684;&#x6807;&#x51C6;&#x53CD;&#x5C04;&#x5E93;&#x83B7;&#x53D6;&#x7684;&#x65B9;&#x6CD5;&#x987A;&#x5E8F;&#x662F;&#x968F;&#x673A;&#x7684;&#xFF0C;&#x751A;&#x81F3;&#x6CE1;&#x5728;&#x76F8;&#x540C;JVM&#x7684;&#x4E0D;&#x540C;&#x5E94;&#x7528;&#x8FD4;&#x56DE;&#x7684;&#x987A;&#x5E8F;&#x4E5F;&#x4F1A;&#x4E0D;&#x4E00;&#x81F4;</span></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      AnnotationMetadata asm =</span><br><span class="line">          <span class="keyword">this</span>.metadataReaderFactory.getMetadataReader(original.getClassName()).getAnnotationMetadata();</span><br><span class="line">      Set&lt;MethodMetadata&gt; asmMethods = asm.getAnnotatedMethods(Bean.class.getName());</span><br><span class="line">      <span class="keyword">if</span> (asmMethods.size() &gt;= beanMethods.size()) {</span><br><span class="line">        Set&lt;MethodMetadata&gt; selectedMethods = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(asmMethods.size());</span><br><span class="line">        <span class="comment">// &#x505A;&#x4E86;&#x4E00;&#x904D;&#x8FC7;&#x6EE4;&#xFF0C;&#x5C06;&#x4E8C;&#x8FDB;&#x5236;class&#x6587;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#x4E0E;JVM&#x53CD;&#x5C04;&#x7684;&#x65B9;&#x6CD5;&#x505A;&#x4E00;&#x6B21;&#x5BF9;&#x6BD4;&#xFF0C;&#x9632;&#x6B62;&#x5C06;&#x975E;&#x7F16;&#x7A0B;&#x65B9;&#x6CD5;&#x52A0;&#x5165;&#xFF0C;&#x4FDD;&#x6301;&#x4E0E;JVM&#x53CD;&#x5C04;&#x83B7;&#x53D6;&#x65B9;&#x6CD5;&#x4E00;&#x81F4;&#xFF0C;&#x9664;&#x4E86;&#x987A;&#x5E8F;&#x3002;</span></span><br><span class="line">        <span class="keyword">for</span> (MethodMetadata asmMethod : asmMethods) {</span><br><span class="line">          <span class="keyword">for</span> (MethodMetadata beanMethod : beanMethods) {</span><br><span class="line">            <span class="keyword">if</span> (beanMethod.getMethodName().equals(asmMethod.getMethodName())) {</span><br><span class="line">              selectedMethods.add(beanMethod);</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            }</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (selectedMethods.size() == beanMethods.size()) {</span><br><span class="line">          <span class="comment">// All reflection-detected methods found in ASM method set -&gt; proceed</span></span><br><span class="line">          beanMethods = selectedMethods;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) {</span><br><span class="line">      logger.debug(<span class="string">&quot;Failed to read class file via ASM for determining @Bean method order&quot;</span>, ex);</span><br><span class="line">      <span class="comment">// No worries, let&apos;s continue with the reflection metadata we started with...</span></span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> beanMethods;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5728;<code>loadBeanDefinitions</code>&#x65B9;&#x6CD5;&#x5185;&#xFF0C;&#x8C03;&#x7528;&#x4E86;<code>loadBeanDefinitionsForConfigurationClass</code>&#x6765;&#x6CE8;&#x518C;Config Bean&#x672C;&#x8EAB;&#x3001;&#x5185;&#x90E8;&#x58F0;&#x660E;&#x7684;<code>@Bean</code>&#x65B9;&#x6CD5;&#x3001;<code>@Import</code>&#x548C;<code>@ImportResource</code>&#x76F8;&#x5173;&#x7684;Bean&#x4FE1;&#x606F;&#x3002;&#x8FD9;&#x91CC;&#x5177;&#x4F53;&#x67E5;&#x770B;&#x6CE8;&#x518C;<code>@Bean</code>&#x7684;&#x8FC7;&#x7A0B;&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x5FAA;&#x73AF;&#x6240;&#x6709;&#x6CE8;&#x89E3;&#x6709;@Bean&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x8C03;&#x7528;loadBeanDefinitionsForBeanMethod&#x65B9;&#x6CD5;&#x6CE8;&#x518C;</span></span><br><span class="line"><span class="keyword">for</span> (BeanMethod beanMethod : configClass.getBeanMethods()) {</span><br><span class="line">  loadBeanDefinitionsForBeanMethod(beanMethod);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p><code>loadBeanDefinitionsForBeanMethod</code>&#x65B9;&#x6CD5;&#x4E3B;&#x8981;&#x662F;&#x505A;&#x4E86;&#x522B;&#x540D;&#x6CE8;&#x518C;&#xFF0C;&#x6CE8;&#x89E3;&#x58F0;&#x660E;&#x7684;&#x7C7B;&#x5B9A;&#x4E49;&#x6CE8;&#x518C;&#x4EE5;&#x53CA;<code>@Scope</code>&#x6CE8;&#x89E3;&#x7684;&#x4EE3;&#x7406;&#x7C7B;&#x8986;&#x76D6;&#x7684;&#x5DE5;&#x4F5C;&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadBeanDefinitionsForBeanMethod</span><span class="params">(BeanMethod beanMethod)</span> </span>{</span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;&#x914D;&#x7F6E;&#x7C7B;&#x4EE5;&#x53CA;&#x6CE8;&#x89E3;&#x65B9;&#x6CD5;&#x7684;&#x76F8;&#x5173;&#x4FE1;&#x606F;</span></span><br><span class="line">  ConfigurationClass configClass = beanMethod.getConfigurationClass();</span><br><span class="line">  MethodMetadata metadata = beanMethod.getMetadata();</span><br><span class="line">  String methodName = metadata.getMethodName();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x8DF3;&#x8FC7;&#x8FD9;&#x4E2A;&#x7C7B;</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.conditionEvaluator.shouldSkip(metadata, ConfigurationPhase.REGISTER_BEAN)) {</span><br><span class="line">    configClass.skippedBeanMethods.add(methodName);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x7C7B;&#x88AB;&#x8DF3;&#x8FC7;&#xFF0C;&#x5219;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;</span></span><br><span class="line">  <span class="keyword">if</span> (configClass.skippedBeanMethods.contains(methodName)) {</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x63D0;&#x53D6;@Bean&#x6CE8;&#x89E3;&#x7684;&#x5C5E;&#x6027;</span></span><br><span class="line">  AnnotationAttributes bean = AnnotationConfigUtils.attributesFor(metadata, Bean.class);</span><br><span class="line">  <span class="comment">// &#x4E0D;&#x5B58;&#x5728;@Bean&#xFF0C;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">  Assert.state(bean != <span class="keyword">null</span>, <span class="string">&quot;No @Bean annotation attributes&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;@Bean&#x6CE8;&#x518C;&#x7684;&#x522B;&#x540D;</span></span><br><span class="line">  List&lt;String&gt; names = <span class="keyword">new</span> ArrayList&lt;&gt;(Arrays.asList(bean.getStringArray(<span class="string">&quot;name&quot;</span>)));</span><br><span class="line">  String beanName = (!names.isEmpty() ? names.remove(<span class="number">0</span>) : methodName);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x6CE8;&#x518C;&#x6240;&#x6709;&#x7684;&#x522B;&#x540D;</span></span><br><span class="line">  <span class="keyword">for</span> (String alias : names) {</span><br><span class="line">    <span class="keyword">this</span>.registry.registerAlias(beanName, alias);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x662F;&#x5426;&#x5141;&#x8BB8;&#x8986;&#x76D6;&#x5DF2;&#x5B58;&#x5728;&#x7684;&#x5B9A;&#x4E49;&#xFF08;&#x5224;&#x65AD;&#x4F9D;&#x636E;&#x6765;&#x81EA;isOverriddenByExistingDefinition&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x505A;&#x5C55;&#x5F00;&#xFF09;</span></span><br><span class="line">  <span class="keyword">if</span> (isOverriddenByExistingDefinition(beanMethod, beanName)) {</span><br><span class="line">    <span class="keyword">if</span> (beanName.equals(beanMethod.getConfigurationClass().getBeanName())) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(beanMethod.getConfigurationClass().getResource().getDescription(),</span><br><span class="line">          beanName, <span class="string">&quot;Bean name derived from @Bean method &apos;&quot;</span> + beanMethod.getMetadata().getMethodName() +</span><br><span class="line">          <span class="string">&quot;&apos; clashes with bean name for containing configuration class; please make those names unique!&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  ConfigurationClassBeanDefinition beanDef = <span class="keyword">new</span> ConfigurationClassBeanDefinition(configClass, metadata);</span><br><span class="line">  beanDef.setResource(configClass.getResource());</span><br><span class="line">  beanDef.setSource(<span class="keyword">this</span>.sourceExtractor.extractSource(metadata, configClass.getResource()));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (metadata.isStatic()) {</span><br><span class="line">    <span class="comment">// static @Bean method</span></span><br><span class="line">    beanDef.setBeanClassName(configClass.getMetadata().getClassName());</span><br><span class="line">    beanDef.setFactoryMethodName(methodName);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// instance @Bean method</span></span><br><span class="line">    beanDef.setFactoryBeanName(configClass.getBeanName());</span><br><span class="line">    beanDef.setUniqueFactoryMethodName(methodName);</span><br><span class="line">  }</span><br><span class="line">  beanDef.setAutowireMode(RootBeanDefinition.AUTOWIRE_CONSTRUCTOR);</span><br><span class="line">  beanDef.setAttribute(RequiredAnnotationBeanPostProcessor.SKIP_REQUIRED_CHECK_ATTRIBUTE, Boolean.TRUE);</span><br><span class="line"></span><br><span class="line">  AnnotationConfigUtils.processCommonDefinitionAnnotations(beanDef, metadata);</span><br><span class="line"></span><br><span class="line">  Autowire autowire = bean.getEnum(<span class="string">&quot;autowire&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (autowire.isAutowire()) {</span><br><span class="line">    beanDef.setAutowireMode(autowire.value());</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  String initMethodName = bean.getString(<span class="string">&quot;initMethod&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (StringUtils.hasText(initMethodName)) {</span><br><span class="line">    beanDef.setInitMethodName(initMethodName);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  String destroyMethodName = bean.getString(<span class="string">&quot;destroyMethod&quot;</span>);</span><br><span class="line">  beanDef.setDestroyMethodName(destroyMethodName);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Scope&#x7684;&#x4EE3;&#x7406;&#x4FE1;&#x606F;&#x83B7;&#x53D6;</span></span><br><span class="line">  ScopedProxyMode proxyMode = ScopedProxyMode.NO;</span><br><span class="line">  AnnotationAttributes attributes = AnnotationConfigUtils.attributesFor(metadata, Scope.class);</span><br><span class="line">  <span class="keyword">if</span> (attributes != <span class="keyword">null</span>) {</span><br><span class="line">    beanDef.setScope(attributes.getString(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">    proxyMode = attributes.getEnum(<span class="string">&quot;proxyMode&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (proxyMode == ScopedProxyMode.DEFAULT) {</span><br><span class="line">      proxyMode = ScopedProxyMode.NO;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;&#x5B58;&#x5728;Scope&#x4EE3;&#x7406;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x4EE3;&#x7406;&#x7C7B;&#x5B9A;&#x4E49;&#x8986;&#x76D6;&#x539F;&#x6709;&#x7684;&#x7C7B;&#x5B9A;&#x4E49;</span></span><br><span class="line">  BeanDefinition beanDefToRegister = beanDef;</span><br><span class="line">  <span class="keyword">if</span> (proxyMode != ScopedProxyMode.NO) {</span><br><span class="line">    BeanDefinitionHolder proxyDef = ScopedProxyCreator.createScopedProxy(</span><br><span class="line">        <span class="keyword">new</span> BeanDefinitionHolder(beanDef, beanName), <span class="keyword">this</span>.registry,</span><br><span class="line">        proxyMode == ScopedProxyMode.TARGET_CLASS);</span><br><span class="line">    beanDefToRegister = <span class="keyword">new</span> ConfigurationClassBeanDefinition(</span><br><span class="line">        (RootBeanDefinition) proxyDef.getBeanDefinition(), configClass, metadata);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (logger.isDebugEnabled()) {</span><br><span class="line">    logger.debug(String.format(<span class="string">&quot;Registering bean definition for @Bean method %s.%s()&quot;</span>,</span><br><span class="line">        configClass.getMetadata().getClassName(), beanName));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x6CE8;&#x518C;&#x7C7B;&#x5B9A;&#x4E49;</span></span><br><span class="line">  <span class="keyword">this</span>.registry.registerBeanDefinition(beanName, beanDefToRegister);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x4E4B;&#x540E;&#x901A;&#x8FC7;Bean&#x5DE5;&#x5382;&#xFF0C;&#x8C03;&#x7528;<code>preInstantiateSingletons</code>&#x65B9;&#x6CD5;&#xFF0C;&#x4E0E;&#x521D;&#x59CB;&#x5316;Bean&#x7684;&#x5355;&#x4F8B;&#x3002;&#x5728;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x540C;&#x6837;&#x5C06;<code>@Bean</code>&#x6807;&#x6CE8;&#x7684;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x521D;&#x59CB;&#x5316;&#x4E86;&#x3002;&#x4E0E;&#x5176;&#x4ED6;&#x7C7B;&#x7684;&#x521D;&#x59CB;&#x5316;&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x6807;&#x6CE8;&#x6709;<code>@Bean</code>&#x7684;&#x7C7B;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x662F;&#x901A;&#x8FC7;<code>factoryMethodName</code>&#x6765;&#x8FDB;&#x884C;&#x7684;(&#x5177;&#x4F53;&#x67E5;&#x770B;&#x7684;<code>AbstractAutowireCapableBeanFactory</code>&#x7C7B;&#x7684;<code>createBeanInstance</code>&#x65B9;&#x6CD5;)&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &#x5224;&#x65AD;&#x662F;&#x5426;&#x5B58;&#x5728;factoryMethodName</span></span><br><span class="line"><span class="keyword">if</span> (mbd.getFactoryMethodName() != <span class="keyword">null</span>)  {</span><br><span class="line">  <span class="comment">// &#x5B58;&#x5728;&#x7684;&#x8BDD;&#xFF0C;&#x5219;&#x901A;&#x8FC7;factoryMethodName&#x6765;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;</span></span><br><span class="line">  <span class="keyword">return</span> instantiateUsingFactoryMethod(beanName, mbd, args);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x901A;&#x8FC7;<code>factoryMethodName</code>&#x521D;&#x59CB;&#x5316;Bean</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> BeanWrapper <span class="title">instantiateUsingFactoryMethod</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    String beanName, RootBeanDefinition mbd, @Nullable Object[] explicitArgs)</span> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> ConstructorResolver(<span class="keyword">this</span>).instantiateUsingFactoryMethod(beanName, mbd, explicitArgs);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>&#x5177;&#x4F53;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> BeanWrapper <span class="title">instantiateUsingFactoryMethod</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			<span class="keyword">final</span> String beanName, <span class="keyword">final</span> RootBeanDefinition mbd, @Nullable <span class="keyword">final</span> Object[] explicitArgs)</span> </span>{</span><br><span class="line"></span><br><span class="line">  BeanWrapperImpl bw = <span class="keyword">new</span> BeanWrapperImpl();</span><br><span class="line">  <span class="keyword">this</span>.beanFactory.initBeanWrapper(bw);</span><br><span class="line"></span><br><span class="line">  Object factoryBean;</span><br><span class="line">  Class&lt;?&gt; factoryClass;</span><br><span class="line">  <span class="keyword">boolean</span> isStatic;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x83B7;&#x53D6;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x6240;&#x5728;&#x914D;&#x7F6E;&#x7C7B;&#x540D;&#x79F0;</span></span><br><span class="line">  String factoryBeanName = mbd.getFactoryBeanName();</span><br><span class="line">  <span class="keyword">if</span> (factoryBeanName != <span class="keyword">null</span>) {</span><br><span class="line">    <span class="comment">// &#x5B58;&#x5728;&#x914D;&#x7F6E;&#x7C7B;&#x540D;&#x79F0;&#xFF0C;&#x5219;@Bean&#x662F;&#x88AB;&#x6807;&#x8BB0;&#x5728;&#x5B9E;&#x4F8B;&#x65B9;&#x6CD5;&#x4E0A;</span></span><br><span class="line">    <span class="comment">// &#x914D;&#x7F6E;&#x7C7B;&#x4E0E;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x6784;&#x5EFA;&#x7684;&#x76EE;&#x6807;&#x7C7B;&#x4E00;&#x81F4;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">    <span class="keyword">if</span> (factoryBeanName.equals(beanName)) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(mbd.getResourceDescription(), beanName,</span><br><span class="line">          <span class="string">&quot;factory-bean reference points back to the same bean definition&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    factoryBean = <span class="keyword">this</span>.beanFactory.getBean(factoryBeanName);</span><br><span class="line">    <span class="comment">// &#x5B58;&#x5728;&#x8BE5;&#x6784;&#x5EFA;&#x76EE;&#x6807;&#x7684;bean&#x540D;&#x79F0;&#x4E0E;&#x5BB9;&#x5668;&#x5185;&#x7684;&#x5176;&#x4ED6;Bean&#x5B9A;&#x4E49;&#x51B2;&#x7A81;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">    <span class="keyword">if</span> (mbd.isSingleton() &amp;&amp; <span class="keyword">this</span>.beanFactory.containsSingleton(beanName)) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ImplicitlyAppearedSingletonException();</span><br><span class="line">    }</span><br><span class="line">    factoryClass = factoryBean.getClass();</span><br><span class="line">    isStatic = <span class="keyword">false</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="comment">// @Bean&#x6807;&#x6CE8;&#x5728;&#x9759;&#x6001;&#x65B9;&#x6CD5;&#x4E0A;</span></span><br><span class="line">    <span class="comment">// &#x4E0D;&#x5B58;&#x5728;&#x6784;&#x5EFA;&#x76EE;&#x6807;&#x7684;Class&#x7C7B;&#x578B;&#xFF0C;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;&#x3002;&#x5373;&#xFF1A;&#x58F0;&#x660E;&#x7684;&#x7C7B;&#x5B9A;&#x4E49;&#x65E2;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;Bean&#x7C7B;&#xFF0C;&#x4E5F;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="keyword">if</span> (!mbd.hasBeanClass()) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BeanDefinitionStoreException(mbd.getResourceDescription(), beanName,</span><br><span class="line">          <span class="string">&quot;bean definition declares neither a bean class nor a factory-bean reference&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    factoryBean = <span class="keyword">null</span>;</span><br><span class="line">    factoryClass = mbd.getBeanClass();</span><br><span class="line">    isStatic = <span class="keyword">true</span>;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  Method factoryMethodToUse = <span class="keyword">null</span>;</span><br><span class="line">  ArgumentsHolder argsHolderToUse = <span class="keyword">null</span>;</span><br><span class="line">  Object[] argsToUse = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &#x5224;&#x65AD;&#x662F;&#x5426;&#x663E;&#x793A;&#x4F20;&#x5165;&#x53C2;&#x6570;</span></span><br><span class="line">  <span class="comment">// &#x5982;&#x679C;&#x4E0D;&#x662F;&#x663E;&#x793A;&#x4F20;&#x5165;&#x53C2;&#x6570;&#xFF0C;&#x5219;&#x6839;&#x636E;constructorArgumentsResolved&#x5224;&#x65AD;&#x662F;&#x5426;&#x9700;&#x8981;&#x89E3;&#x6790;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;</span></span><br><span class="line">  <span class="keyword">if</span> (explicitArgs != <span class="keyword">null</span>) {</span><br><span class="line">    argsToUse = explicitArgs;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    Object[] argsToResolve = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// &#x4F7F;&#x7528;&#x9501;&#xFF0C;&#x4FDD;&#x8BC1;&#x8BFB;&#x53D6;&#x5230;&#x7684;resolvedConstructorOrFactoryMethod&#x3001;constructorArgumentsResolved&#x3001;resolvedConstructorArguments&#x4EE5;&#x53CA;preparedConstructorArguments&#x662F;&#x6B63;&#x786E;&#x7684;&#xFF0C;&#x9632;&#x6B62;&#x7EBF;&#x7A0B;&#x5728;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4FEE;&#x6539;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x8BFB;&#x53D6;&#x9519;&#x8BEF;&#x7684;&#x6570;&#x636E;</span></span><br><span class="line">    <span class="comment">// &#x67E5;&#x770B;&#x662F;&#x5426;&#x5B58;&#x5728;&#x4E00;&#x4E2A;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x7684;&#x7F13;&#x5B58;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x91CD;&#x65B0;&#x67E5;&#x627E;&#x5339;&#x914D;&#xFF0C;&#x5E76;&#x5728;&#x67E5;&#x627E;&#x5B8C;&#x6210;&#x540E;&#xFF0C;&#x505A;storeCache&#x7684;&#x7F13;&#x5B58;&#x4F5C;&#x4E1A;</span></span><br><span class="line">    <span class="keyword">synchronized</span> (mbd.constructorArgumentLock) {</span><br><span class="line">      factoryMethodToUse = (Method) mbd.resolvedConstructorOrFactoryMethod;</span><br><span class="line">      <span class="keyword">if</span> (factoryMethodToUse != <span class="keyword">null</span> &amp;&amp; mbd.constructorArgumentsResolved) {</span><br><span class="line">        <span class="comment">// &#x627E;&#x5230;&#x4E00;&#x4E2A;&#x7F13;&#x5B58;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF08;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x6216;&#x8005;&#x7C7B;&#x6784;&#x9020;&#x5668;&#xFF09;</span></span><br><span class="line">        argsToUse = mbd.resolvedConstructorArguments;</span><br><span class="line">        <span class="keyword">if</span> (argsToUse == <span class="keyword">null</span>) {</span><br><span class="line">          argsToResolve = mbd.preparedConstructorArguments;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x5BF9;&#x4E8E;&#x4F20;&#x5165;&#x7684;&#x53C2;&#x6570;&#x505A;&#x89E3;&#x6790;</span></span><br><span class="line">    <span class="keyword">if</span> (argsToResolve != <span class="keyword">null</span>) {</span><br><span class="line">      argsToUse = resolvePreparedArguments(beanName, mbd, bw, factoryMethodToUse, argsToResolve);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (factoryMethodToUse == <span class="keyword">null</span> || argsToUse == <span class="keyword">null</span>) {</span><br><span class="line">    <span class="comment">// &#x65E0;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x901A;&#x8FC7;&#x53CD;&#x5C04;&#x67E5;&#x627E;&#x5339;&#x914D;&#x7684;&#x65B9;&#x6CD5;</span></span><br><span class="line">    factoryClass = ClassUtils.getUserClass(factoryClass);</span><br><span class="line"></span><br><span class="line">    Method[] rawCandidates = getCandidateMethods(factoryClass, mbd);</span><br><span class="line">    List&lt;Method&gt; candidateSet = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Method candidate : rawCandidates) {</span><br><span class="line">      <span class="comment">// &#x5C06;&#x5339;&#x914D;&#x7684;&#x65B9;&#x6CD5;&#x653E;&#x5230;&#x5217;&#x8868;&#x5185;&#x7F13;&#x5B58;&#xFF08;&#x662F;&#x5426;&#x9759;&#x6001;&#x5E76;&#x4E14;&#x65B9;&#x6CD5;&#x540D;&#x662F;&#x5426;&#x4E00;&#x81F4;&#xFF09;</span></span><br><span class="line">      <span class="keyword">if</span> (Modifier.isStatic(candidate.getModifiers()) == isStatic &amp;&amp; mbd.isFactoryMethod(candidate)) {</span><br><span class="line">        candidateSet.add(candidate);</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    Method[] candidates = candidateSet.toArray(<span class="keyword">new</span> Method[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// &#x6392;&#x5E8F;&#xFF08;&#x6309;&#x7167;&#x662F;&#x5426;&#x516C;&#x5F00;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x4E14;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x6392;&#x5E8F;&#xFF09;</span></span><br><span class="line">    AutowireUtils.sortFactoryMethods(candidates);</span><br><span class="line"></span><br><span class="line">    ConstructorArgumentValues resolvedValues = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">boolean</span> autowiring = (mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_CONSTRUCTOR);</span><br><span class="line">    <span class="keyword">int</span> minTypeDiffWeight = Integer.MAX_VALUE;</span><br><span class="line">    Set&lt;Method&gt; ambiguousFactoryMethods = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> minNrOfArgs;</span><br><span class="line">    <span class="keyword">if</span> (explicitArgs != <span class="keyword">null</span>) {</span><br><span class="line">      minNrOfArgs = explicitArgs.length;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">      <span class="comment">// &#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x901A;&#x8FC7;&#x7A0B;&#x5E8F;&#x6027;&#x4F20;&#x5165;&#x6784;&#x9020;&#x53C2;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x624B;&#x52A8;&#x5224;&#x65AD;&#x5E76;&#x89E3;&#x6790;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;</span></span><br><span class="line">      <span class="comment">// &#x5982;&#x679C;&#x5B58;&#x5728;&#x6784;&#x9020;&#x53C2;&#x6570;&#xFF0C;&#x5219;&#x89E3;&#x6790;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;</span></span><br><span class="line">      <span class="keyword">if</span> (mbd.hasConstructorArgumentValues()) {</span><br><span class="line">        ConstructorArgumentValues cargs = mbd.getConstructorArgumentValues();</span><br><span class="line">        resolvedValues = <span class="keyword">new</span> ConstructorArgumentValues();</span><br><span class="line">        minNrOfArgs = resolveConstructorArguments(beanName, mbd, bw, cargs, resolvedValues);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        minNrOfArgs = <span class="number">0</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    LinkedList&lt;UnsatisfiedDependencyException&gt; causes = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x904D;&#x5386;&#x4E0E;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x540D;&#x5B57;&#x76F8;&#x540C;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="keyword">for</span> (Method candidate : candidates) {</span><br><span class="line">      <span class="comment">// &#x83B7;&#x53D6;&#x65B9;&#x6CD5;&#x7684;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x5217;&#x8868;</span></span><br><span class="line">      Class&lt;?&gt;[] paramTypes = candidate.getParameterTypes();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (paramTypes.length &gt;= minNrOfArgs) {</span><br><span class="line">        ArgumentsHolder argsHolder;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (explicitArgs != <span class="keyword">null</span>){</span><br><span class="line">          <span class="comment">// &#x5982;&#x679C;&#x662F;&#x663E;&#x5F0F;&#x58F0;&#x660E;&#x7684;&#x6784;&#x9020;&#x53C2;&#x6570;&#xFF0C;&#x5219;&#x53CD;&#x5C04;&#x83B7;&#x5F97;&#x7684;&#x6784;&#x9020;&#x65B9;&#x6CD5;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x957F;&#x5EA6;&#x4E0E;&#x663E;&#x793A;&#x53C2;&#x6570;&#x7684;&#x4E2A;&#x6570;&#x9700;&#x8981;&#x4FDD;&#x6301;&#x4E00;&#x81F4;</span></span><br><span class="line">          <span class="comment">// &#x5373;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x90FD;&#x662F;&#x5FC5;&#x8981;&#x6027;&#x53C2;&#x6570;</span></span><br><span class="line">          <span class="keyword">if</span> (paramTypes.length != explicitArgs.length) {</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">          }</span><br><span class="line">          argsHolder = <span class="keyword">new</span> ArgumentsHolder(explicitArgs);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span> {</span><br><span class="line">          <span class="comment">// &#x89E3;&#x6790;&#x6784;&#x9020;&#x53C2;&#x6570;&#xFF0C;&#x8FD9;&#x4E9B;&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x662F;&#x5FC5;&#x586B;&#x6216;&#x8005;&#x975E;&#x5FC5;&#x586B;</span></span><br><span class="line">          <span class="keyword">try</span> {</span><br><span class="line">            String[] paramNames = <span class="keyword">null</span>;</span><br><span class="line">            ParameterNameDiscoverer pnd = <span class="keyword">this</span>.beanFactory.getParameterNameDiscoverer();</span><br><span class="line">            <span class="keyword">if</span> (pnd != <span class="keyword">null</span>) {</span><br><span class="line">              paramNames = pnd.getParameterNames(candidate);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// &#x6839;&#x636E;&#x4FE1;&#x606F;&#x521B;&#x5EFA;&#x6784;&#x9020;&#x53C2;&#x6570;&#x5217;&#x8868;</span></span><br><span class="line">            argsHolder = createArgumentArray(</span><br><span class="line">                beanName, mbd, resolvedValues, bw, paramTypes, paramNames, candidate, autowiring);</span><br><span class="line">          }</span><br><span class="line">          <span class="keyword">catch</span> (UnsatisfiedDependencyException ex) {</span><br><span class="line">            <span class="keyword">if</span> (logger.isTraceEnabled()) {</span><br><span class="line">              logger.trace(<span class="string">&quot;Ignoring factory method [&quot;</span> + candidate + <span class="string">&quot;] of bean &apos;&quot;</span> + beanName + <span class="string">&quot;&apos;: &quot;</span> + ex);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// Swallow and try next overloaded factory method.</span></span><br><span class="line">            <span class="keyword">if</span> (causes == <span class="keyword">null</span>) {</span><br><span class="line">              causes = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">            }</span><br><span class="line">            causes.add(ex);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="comment">// &#x6839;&#x636E;&#x5B9A;&#x4E49;&#x7684;&#x662F;&#x5426;&#x4E3A;&#x5BBD;&#x677E;&#x6A21;&#x5F0F;&#x6765;&#x505A;&#x7C7B;&#x578B;&#x5DEE;&#x5F02;&#x6743;&#x91CD;&#x7684;&#x5224;&#x65AD;</span></span><br><span class="line">        <span class="keyword">int</span> typeDiffWeight = (mbd.isLenientConstructorResolution() ?</span><br><span class="line">            argsHolder.getTypeDifferenceWeight(paramTypes) : argsHolder.getAssignabilityWeight(paramTypes));</span><br><span class="line">        <span class="comment">// &#x9009;&#x62E9;&#x6700;&#x63A5;&#x8FD1;&#x7684;&#x4E00;&#x4E2A;&#x6784;&#x9020;&#x65B9;&#x6CD5;</span></span><br><span class="line">        <span class="keyword">if</span> (typeDiffWeight &lt; minTypeDiffWeight) {</span><br><span class="line">          factoryMethodToUse = candidate;</span><br><span class="line">          argsHolderToUse = argsHolder;</span><br><span class="line">          argsToUse = argsHolder.arguments;</span><br><span class="line">          minTypeDiffWeight = typeDiffWeight;</span><br><span class="line">          ambiguousFactoryMethods = <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x67E5;&#x51FA;&#x6DF7;&#x6DC6;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;&#x9632;&#x6B62;&#x51FA;&#x73B0;&#x76F8;&#x540C;&#x540D;&#x5B57;&#x3001;&#x76F8;&#x540C;&#x53C2;&#x6570;&#x4E2A;&#x6570;&#x4EE5;&#x53CA;&#x53C2;&#x6570;&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x6CD5;&#xFF1B;</span></span><br><span class="line">        <span class="comment">// &#x6536;&#x96C6;&#x8FD9;&#x4E9B;&#x65B9;&#x6CD5;&#x5E76;&#x5728;&#x51FA;&#x73B0;&#x591A;&#x4E2A;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x629B;&#x51FA;&#x6DF7;&#x6DC6;&#x5F02;&#x5E38;&#x3002;</span></span><br><span class="line">        <span class="comment">// &#x8FD9;&#x4E2A;&#x68C0;&#x67E5;&#x53EA;&#x4F1A;&#x5728;&#x4E25;&#x683C;&#x6A21;&#x5F0F;&#x4E0B;&#x6267;&#x884C;&#x5E76;&#x4E14;&#x4F1A;&#x5FFD;&#x7565;&#x6389;&#x91CD;&#x5199;&#x7684;&#x65B9;&#x6CD5;&#xFF08;Override&#xFF09;</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (factoryMethodToUse != <span class="keyword">null</span> &amp;&amp; typeDiffWeight == minTypeDiffWeight &amp;&amp;</span><br><span class="line">            !mbd.isLenientConstructorResolution() &amp;&amp;</span><br><span class="line">            paramTypes.length == factoryMethodToUse.getParameterCount() &amp;&amp;</span><br><span class="line">            !Arrays.equals(paramTypes, factoryMethodToUse.getParameterTypes())) {</span><br><span class="line">          <span class="keyword">if</span> (ambiguousFactoryMethods == <span class="keyword">null</span>) {</span><br><span class="line">            ambiguousFactoryMethods = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br><span class="line">            ambiguousFactoryMethods.add(factoryMethodToUse);</span><br><span class="line">          }</span><br><span class="line">          ambiguousFactoryMethods.add(candidate);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x672A;&#x5339;&#x914D;&#x5230;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;</span></span><br><span class="line">    <span class="keyword">if</span> (factoryMethodToUse == <span class="keyword">null</span>) {</span><br><span class="line">      <span class="comment">// &#x5224;&#x65AD;&#x662F;&#x5426;&#x5B58;&#x5728;&#x5F02;&#x5E38;&#xFF0C;&#x5B58;&#x5728;&#x7684;&#x8BDD;&#xFF0C;&#x6267;&#x884C;Bean&#x7684;&#x56DE;&#x8C03;onSuppressedException&#x65B9;&#x6CD5;&#x540E;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">      <span class="keyword">if</span> (causes != <span class="keyword">null</span>) {</span><br><span class="line">        UnsatisfiedDependencyException ex = causes.removeLast();</span><br><span class="line">        <span class="keyword">for</span> (Exception cause : causes) {</span><br><span class="line">          <span class="keyword">this</span>.beanFactory.onSuppressedException(cause);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">      }</span><br><span class="line">      <span class="comment">// &#x83B7;&#x53D6;&#x53C2;&#x6570;&#x7C7B;&#x578B;</span></span><br><span class="line">      List&lt;String&gt; argTypes = <span class="keyword">new</span> ArrayList&lt;&gt;(minNrOfArgs);</span><br><span class="line">      <span class="keyword">if</span> (explicitArgs != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">for</span> (Object arg : explicitArgs) {</span><br><span class="line">          argTypes.add(arg != <span class="keyword">null</span> ? arg.getClass().getSimpleName() : <span class="string">&quot;null&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (resolvedValues != <span class="keyword">null</span>){</span><br><span class="line">        Set&lt;ValueHolder&gt; valueHolders = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(resolvedValues.getArgumentCount());</span><br><span class="line">        valueHolders.addAll(resolvedValues.getIndexedArgumentValues().values());</span><br><span class="line">        valueHolders.addAll(resolvedValues.getGenericArgumentValues());</span><br><span class="line">        <span class="keyword">for</span> (ValueHolder value : valueHolders) {</span><br><span class="line">          String argType = (value.getType() != <span class="keyword">null</span> ? ClassUtils.getShortName(value.getType()) :</span><br><span class="line">              (value.getValue() != <span class="keyword">null</span> ? value.getValue().getClass().getSimpleName() : <span class="string">&quot;null&quot;</span>));</span><br><span class="line">          argTypes.add(argType);</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      String argDesc = StringUtils.collectionToCommaDelimitedString(argTypes);</span><br><span class="line">      <span class="comment">// &#x629B;&#x51FA;&#x672A;&#x5339;&#x914D;&#x5230;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x7684;&#x5F02;&#x5E38;</span></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">          <span class="string">&quot;No matching factory method found: &quot;</span> +</span><br><span class="line">          (mbd.getFactoryBeanName() != <span class="keyword">null</span> ?</span><br><span class="line">            <span class="string">&quot;factory bean &apos;&quot;</span> + mbd.getFactoryBeanName() + <span class="string">&quot;&apos;; &quot;</span> : <span class="string">&quot;&quot;</span>) +</span><br><span class="line">          <span class="string">&quot;factory method &apos;&quot;</span> + mbd.getFactoryMethodName() + <span class="string">&quot;(&quot;</span> + argDesc + <span class="string">&quot;)&apos;. &quot;</span> +</span><br><span class="line">          <span class="string">&quot;Check that a method with the specified name &quot;</span> +</span><br><span class="line">          (minNrOfArgs &gt; <span class="number">0</span> ? <span class="string">&quot;and arguments &quot;</span> : <span class="string">&quot;&quot;</span>) +</span><br><span class="line">          <span class="string">&quot;exists and that it is &quot;</span> +</span><br><span class="line">          (isStatic ? <span class="string">&quot;static&quot;</span> : <span class="string">&quot;non-static&quot;</span>) + <span class="string">&quot;.&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x5BF9;&#x4E8E;&#x8FD4;&#x56DE;&#x7C7B;&#x578B;&#x4E3A;void&#x7684;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#xFF0C;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">void</span>.class == factoryMethodToUse.getReturnType()) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">          <span class="string">&quot;Invalid factory method &apos;&quot;</span> + mbd.getFactoryMethodName() +</span><br><span class="line">          <span class="string">&quot;&apos;: needs to have a non-void return type!&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// &#x5B58;&#x5728;&#x591A;&#x4E2A;&#x6DF7;&#x6DC6;&#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x629B;&#x51FA;&#x5F02;&#x5E38;</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (ambiguousFactoryMethods != <span class="keyword">null</span>) {</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">          <span class="string">&quot;Ambiguous factory method matches found in bean &apos;&quot;</span> + beanName + <span class="string">&quot;&apos; &quot;</span> +</span><br><span class="line">          <span class="string">&quot;(hint: specify index/type/name arguments for simple parameters to avoid type ambiguities): &quot;</span> +</span><br><span class="line">          ambiguousFactoryMethods);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x5C06;&#x76F8;&#x5173;&#x7684;&#x6784;&#x5EFA;&#x4FE1;&#x606F;&#x5B58;&#x5165;&#x7F13;&#x5B58;&#xFF0C;&#x7528;&#x4E8E;&#x4EE5;&#x540E;&#x7684;&#x91CD;&#x65B0;&#x521B;&#x5EFA;</span></span><br><span class="line">    <span class="keyword">if</span> (explicitArgs == <span class="keyword">null</span> &amp;&amp; argsHolderToUse != <span class="keyword">null</span>) {</span><br><span class="line">      argsHolderToUse.storeCache(mbd, factoryMethodToUse);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    Object beanInstance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#x521B;&#x5EFA;&#x7C7B;&#x5B9E;&#x4F8B;</span></span><br><span class="line">    <span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span>) {</span><br><span class="line">      <span class="keyword">final</span> Object fb = factoryBean;</span><br><span class="line">      <span class="keyword">final</span> Method factoryMethod = factoryMethodToUse;</span><br><span class="line">      <span class="keyword">final</span> Object[] args = argsToUse;</span><br><span class="line">      beanInstance = AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt;</span><br><span class="line">          beanFactory.getInstantiationStrategy().instantiate(mbd, beanName, beanFactory, fb, factoryMethod, args),</span><br><span class="line">          beanFactory.getAccessControlContext());</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">      beanInstance = <span class="keyword">this</span>.beanFactory.getInstantiationStrategy().instantiate(</span><br><span class="line">          mbd, beanName, <span class="keyword">this</span>.beanFactory, factoryBean, factoryMethodToUse, argsToUse);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    bw.setBeanInstance(beanInstance);</span><br><span class="line">    <span class="keyword">return</span> bw;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">        <span class="string">&quot;Bean instantiation via factory method failed&quot;</span>, ex);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x5B9E;&#x4F8B;&#x521B;&#x5EFA;&#x8BE6;&#x60C5;&#x5982;&#x4E0B;&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">instantiate</span><span class="params">(RootBeanDefinition bd, @Nullable String beanName, BeanFactory owner,</span></span></span><br><span class="line"><span class="function"><span class="params">    @Nullable Object factoryBean, <span class="keyword">final</span> Method factoryMethod, @Nullable Object... args)</span> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    <span class="comment">// &#x8BBE;&#x7F6E;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x53EF;&#x8BBF;&#x95EE;</span></span><br><span class="line">    <span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span>) {</span><br><span class="line">      AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; {</span><br><span class="line">        ReflectionUtils.makeAccessible(factoryMethod);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">      });</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">      ReflectionUtils.makeAccessible(factoryMethod);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// currentlyInvokedFactoryMethod&#x7528;&#x4E8E;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x662F;&#x5426;&#x6B63;&#x5728;&#x521B;&#x5EFA;&#x67D0;&#x4E2A;bean</span></span><br><span class="line">    <span class="comment">// &#x88AB;&#x7528;&#x4E8E;BeanMethodInterceptor&#x7C7B;&#x7684;intercept&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="comment">// &#x4EE5;&#x53CA;BeanMethodInterceptor&#x7C7B;&#x7684;resolveBeanReference&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="comment">// &#x5177;&#x4F53;&#x5E94;&#x7528;&#x573A;&#x666F;&#x4EE5;&#x53CA;&#x76F8;&#x5173;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x51B5;&#x5F85;&#x63A2;&#x7A76;</span></span><br><span class="line">    <span class="comment">// &#x5907;&#x4EFD;&#x4E4B;&#x524D;&#x7684;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;</span></span><br><span class="line">    Method priorInvokedFactoryMethod = currentlyInvokedFactoryMethod.get();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">      <span class="comment">// &#x8BBE;&#x7F6E;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x4E3A;&#x5F53;&#x524D;&#x7684;&#x7C7B;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;</span></span><br><span class="line">      currentlyInvokedFactoryMethod.set(factoryMethod);</span><br><span class="line">      <span class="comment">// &#x6267;&#x884C;&#x6784;&#x5EFA;&#x65B9;&#x6CD5;&#x5E76;&#x83B7;&#x5F97;&#x8FD4;&#x56DE;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;null&#xFF0C;&#x5219;&#x8FD4;&#x56DE;NullBean&#x5B9E;&#x4F8B;</span></span><br><span class="line">      Object result = factoryMethod.invoke(factoryBean, args);</span><br><span class="line">      <span class="keyword">if</span> (result == <span class="keyword">null</span>) {</span><br><span class="line">        result = <span class="keyword">new</span> NullBean();</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">finally</span> {</span><br><span class="line">      <span class="comment">// &#x6062;&#x590D;&#x73B0;&#x573A;</span></span><br><span class="line">      <span class="keyword">if</span> (priorInvokedFactoryMethod != <span class="keyword">null</span>) {</span><br><span class="line">        currentlyInvokedFactoryMethod.set(priorInvokedFactoryMethod);</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">else</span> {</span><br><span class="line">        currentlyInvokedFactoryMethod.remove();</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">catch</span> (IllegalArgumentException ex) {</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> BeanInstantiationException(factoryMethod,</span><br><span class="line">        <span class="string">&quot;Illegal arguments to factory method &apos;&quot;</span> + factoryMethod.getName() + <span class="string">&quot;&apos;; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;args: &quot;</span> + StringUtils.arrayToCommaDelimitedString(args), ex);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">catch</span> (IllegalAccessException ex) {</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> BeanInstantiationException(factoryMethod,</span><br><span class="line">        <span class="string">&quot;Cannot access factory method &apos;&quot;</span> + factoryMethod.getName() + <span class="string">&quot;&apos;; is it public?&quot;</span>, ex);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">catch</span> (InvocationTargetException ex) {</span><br><span class="line">    String msg = <span class="string">&quot;Factory method &apos;&quot;</span> + factoryMethod.getName() + <span class="string">&quot;&apos; threw exception&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (bd.getFactoryBeanName() != <span class="keyword">null</span> &amp;&amp; owner <span class="keyword">instanceof</span> ConfigurableBeanFactory &amp;&amp;</span><br><span class="line">        ((ConfigurableBeanFactory) owner).isCurrentlyInCreation(bd.getFactoryBeanName())) {</span><br><span class="line">      msg = <span class="string">&quot;Circular reference involving containing bean &apos;&quot;</span> + bd.getFactoryBeanName() + <span class="string">&quot;&apos; - consider &quot;</span> +</span><br><span class="line">          <span class="string">&quot;declaring the factory method as static for independence from its containing instance. &quot;</span> + msg;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> BeanInstantiationException(factoryMethod, msg, ex.getTargetException());</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="Bean&#x7684;&#x987A;&#x5E8F;"><a href="#Bean&#x7684;&#x987A;&#x5E8F;" class="headerlink" title="@Bean&#x7684;&#x987A;&#x5E8F;"></a>@Bean&#x7684;&#x987A;&#x5E8F;</h3><p><code>@Bean</code>&#x5982;&#x679C;&#x5728;&#x914D;&#x7F6E;&#x7C7B;&#x5185;&#x90E8;&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x5982;&#x4E0B;&#x8FD9;&#x6BB5;&#x4EE3;&#x7801;&#x77E5;&#x9053;&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (beanMethods.size() &gt; <span class="number">1</span> &amp;&amp; original <span class="keyword">instanceof</span> StandardAnnotationMetadata) {</span><br><span class="line">  <span class="comment">// &#x5C1D;&#x8BD5;&#x901A;&#x8FC7;ASM&#x4ECE;&#x7C7B;&#x6587;&#x4EF6;&#x5224;&#x65AD;&#x65B9;&#x6CD5;&#x7684;&#x987A;&#x5E8F;...&#x56E0;&#x4E3A;&#xFF0C;JVM&#x7684;&#x6807;&#x51C6;&#x53CD;&#x5C04;&#x5E93;&#x83B7;&#x53D6;&#x7684;&#x65B9;&#x6CD5;&#x987A;&#x5E8F;&#x662F;&#x968F;&#x673A;&#x7684;&#xFF0C;&#x751A;&#x81F3;&#x6CE1;&#x5728;&#x76F8;&#x540C;JVM&#x7684;&#x4E0D;&#x540C;&#x5E94;&#x7528;&#x8FD4;&#x56DE;&#x7684;&#x987A;&#x5E8F;&#x4E5F;&#x4F1A;&#x4E0D;&#x4E00;&#x81F4;</span></span><br><span class="line">  <span class="keyword">try</span> {</span><br><span class="line">    AnnotationMetadata asm =</span><br><span class="line">        <span class="keyword">this</span>.metadataReaderFactory.getMetadataReader(original.getClassName()).getAnnotationMetadata();</span><br><span class="line">    Set&lt;MethodMetadata&gt; asmMethods = asm.getAnnotatedMethods(Bean.class.getName());</span><br><span class="line">    <span class="keyword">if</span> (asmMethods.size() &gt;= beanMethods.size()) {</span><br><span class="line">      Set&lt;MethodMetadata&gt; selectedMethods = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(asmMethods.size());</span><br><span class="line">      <span class="comment">// &#x505A;&#x4E86;&#x4E00;&#x904D;&#x8FC7;&#x6EE4;&#xFF0C;&#x5C06;&#x4E8C;&#x8FDB;&#x5236;class&#x6587;&#x4EF6;&#x7684;&#x65B9;&#x6CD5;&#x4E0E;JVM&#x53CD;&#x5C04;&#x7684;&#x65B9;&#x6CD5;&#x505A;&#x4E00;&#x6B21;&#x5BF9;&#x6BD4;&#xFF0C;&#x9632;&#x6B62;&#x5C06;&#x975E;&#x7F16;&#x7A0B;&#x65B9;&#x6CD5;&#x52A0;&#x5165;&#xFF0C;&#x4FDD;&#x6301;&#x4E0E;JVM&#x53CD;&#x5C04;&#x83B7;&#x53D6;&#x65B9;&#x6CD5;&#x4E00;&#x81F4;&#xFF0C;&#x9664;&#x4E86;&#x987A;&#x5E8F;&#x3002;</span></span><br><span class="line">      <span class="keyword">for</span> (MethodMetadata asmMethod : asmMethods) {</span><br><span class="line">        <span class="keyword">for</span> (MethodMetadata beanMethod : beanMethods) {</span><br><span class="line">          <span class="keyword">if</span> (beanMethod.getMethodName().equals(asmMethod.getMethodName())) {</span><br><span class="line">            selectedMethods.add(beanMethod);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          }</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="keyword">if</span> (selectedMethods.size() == beanMethods.size()) {</span><br><span class="line">        <span class="comment">// All reflection-detected methods found in ASM method set -&gt; proceed</span></span><br><span class="line">        beanMethods = selectedMethods;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">catch</span> (IOException ex) {</span><br><span class="line">    logger.debug(<span class="string">&quot;Failed to read class file via ASM for determining @Bean method order&quot;</span>, ex);</span><br><span class="line">    <span class="comment">// No worries, let&apos;s continue with the reflection metadata we started with...</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x662F;&#x6839;&#x636E;&#x4EE3;&#x7801;&#x7F16;&#x5199;&#x987A;&#x5E8F;&#x6765;&#x6267;&#x884C;&#x3002;</p><p>&#x5982;&#x679C;&#x5B9E;&#x5728;&#x4E0D;&#x540C;&#x7684;<code>Configuration</code>&#x7C7B;&#x5185;&#xFF0C;&#x5219;&#x5224;&#x65AD;&#x4F9D;&#x636E;&#x79FB;&#x690D;&#x5230;&#x7C7B;&#x5C42;&#x6B21;&#x3002;&#x5982;&#x679C;&#x7C7B;&#x5B9E;&#x73B0;&#x4E86;<code>Ordered</code>&#x63A5;&#x53E3;&#x6216;&#x8005;&#x6CE8;&#x89E3;&#x6709;<code>@Order</code>&#x6216;&#x8005;<code>@Prority</code>&#xFF0C;&#x5219;&#x6839;&#x636E;&#x4ED6;&#x4EEC;&#x7684;&#x503C;&#x83B7;&#x53D6;&#x6392;&#x5E8F;&#xFF0C;&#x5426;&#x5219;&#x6839;&#x636E;&#x626B;&#x63CF;&#x7684;&#x987A;&#x5E8F;&#x6765;&#x5224;&#x5B9A;&#x3002;</p><h3 id="Bean&#x7684;&#x8986;&#x76D6;&#x95EE;&#x9898;"><a href="#Bean&#x7684;&#x8986;&#x76D6;&#x95EE;&#x9898;" class="headerlink" title="@Bean&#x7684;&#x8986;&#x76D6;&#x95EE;&#x9898;"></a>@Bean&#x7684;&#x8986;&#x76D6;&#x95EE;&#x9898;</h3><p>&#x5982;&#x679C;&#x5B58;&#x5728;<code>@Bean</code>&#x6CE8;&#x89E3;&#x5185;&#x7684;name&#x76F8;&#x540C;&#x6216;&#x8005;&#x65E0;name&#x65B9;&#x6CD5;&#x540D;&#x76F8;&#x540C;&#xFF0C;&#x5219;&#x6839;&#x636E;<code>@Bean</code>&#x7684;&#x987A;&#x5E8F;&#x6765;&#x8FDB;&#x884C;&#x5BF9;&#x5E94;&#x7684;&#x8986;&#x76D6;&#x3002;</p><h3 id="Spring&#x4F1A;&#x62E6;&#x622A;&#x6240;&#x6709;&#x6807;&#x8BB0;&#x4E3A;-Bean&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5BB9;&#x5668;&#x5185;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;"><a href="#Spring&#x4F1A;&#x62E6;&#x622A;&#x6240;&#x6709;&#x6807;&#x8BB0;&#x4E3A;-Bean&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5BB9;&#x5668;&#x5185;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;" class="headerlink" title="Spring&#x4F1A;&#x62E6;&#x622A;&#x6240;&#x6709;&#x6807;&#x8BB0;&#x4E3A;@Bean&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5BB9;&#x5668;&#x5185;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;"></a>Spring&#x4F1A;&#x62E6;&#x622A;&#x6240;&#x6709;&#x6807;&#x8BB0;&#x4E3A;@Bean&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x5BB9;&#x5668;&#x5185;&#x5355;&#x4F8B;&#x5BF9;&#x8C61;</h3><p>&#x5148;&#x8BF4;&#x7ED3;&#x8BBA;&#xFF0C;&#x8FD9;&#x4E2A;&#x89C2;&#x70B9;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x3002;&#x53EF;&#x4EE5;&#x4ECE;<a href="#@Bean&#x7684;&#x5904;&#x7406;">@Bean&#x7684;&#x5904;&#x7406;</a>&#x4E86;&#x89E3;&#x5230;&#xFF0C;&#x7C7B;&#x7684;&#x521D;&#x59CB;&#x5316;&#xFF0C;&#x5E76;&#x6CA1;&#x6709;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8C03;&#x7528;&#x4E86;&#x5176;&#x4ED6;<code>@Bean</code>&#x6CE8;&#x89E3;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x662F;&#x901A;&#x8FC7;&#xFF1A;<br></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object result = factoryMethod.invoke(factoryBean, args);</span><br></pre></td></tr></tbody></table></figure><p></p><p>&#x76F4;&#x63A5;&#x521B;&#x5EFA;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x80AF;&#x5B9A;&#x7684;&#x662F;&#xFF1A;&#x8C03;&#x7528;&#x5176;&#x4ED6;<code>@Bean</code>&#x6CE8;&#x89E3;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5185;&#x90E8;&#x4F7F;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x4E0E;<code>@Bean</code>&#x672C;&#x8EAB;&#x521B;&#x5EFA;&#x7684;&#x5BF9;&#x8C61;&#x5E76;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x5982;&#x679C;&#x591A;&#x4E2A;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x67D0;&#x4E2A;&#x88AB;&#x6CE8;&#x89E3;&#x6709;<code>@Bean</code>&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5219;&#x83B7;&#x53D6;&#x7684;&#x5185;&#x90E8;&#x5BF9;&#x8C61;&#x4E5F;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;</p><h3 id="&#x65B9;&#x6CD5;&#x7EA7;&#x522B;&#x7684;-Bean&#x662F;&#x5426;&#x7531;AOP&#x5B9E;&#x73B0;"><a href="#&#x65B9;&#x6CD5;&#x7EA7;&#x522B;&#x7684;-Bean&#x662F;&#x5426;&#x7531;AOP&#x5B9E;&#x73B0;" class="headerlink" title="&#x65B9;&#x6CD5;&#x7EA7;&#x522B;&#x7684;@Bean&#x662F;&#x5426;&#x7531;AOP&#x5B9E;&#x73B0;"></a>&#x65B9;&#x6CD5;&#x7EA7;&#x522B;&#x7684;@Bean&#x662F;&#x5426;&#x7531;AOP&#x5B9E;&#x73B0;</h3><p>&#x540C;&#x6837;&#x7684;&#xFF0C;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E00;&#x76EE;&#x4E86;&#x7136;&#xFF0C;&#x4E0D;&#x662F;&#x7531;AOP&#x5B9E;&#x73B0;&#xFF1B;&#x4E0D;&#x8FC7;&#xFF0C;&#x5982;&#x679C;&#x663E;&#x793A;&#x6CE8;&#x89E3;&#x4E86;<code>@Scope</code>&#xFF0C;&#x5E76;&#x4E14;&#x975E;NONE&#xFF0C;&#x5219;&#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x8986;&#x76D6;&#x7C7B;&#x5B9A;&#x4E49;&#x3002;&#x8FD9;&#x4E2A;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x7684;&#x786E;&#x4F7F;&#x7528;&#x4E86;&#x7C7B;AOP&#x7684;&#x6982;&#x5FF5;&#x3002;</p><script>document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });</script></div></div><div class="article-copyright"><div class="copyright"><p><span>本文标题:</span><a href="/Spring-Bean解析分析过程.html">Spring @Bean解析分析过程</a></p><p><span>文章作者:</span><a href="/" title="访问 WhatAKitty 的个人博客">WhatAKitty</a></p><p><span>发布时间:</span>2018年08月24日 - 00时35分</p><p><span>最后更新:</span>2018年08月24日 - 00时43分</p><p><span>原始链接:</span><a href="/Spring-Bean解析分析过程.html" title="Spring @Bean解析分析过程">https://xuqiang.me/Spring-Bean解析分析过程.html</a> <span class="btn" data-clipboard-text="原文: https://xuqiang.me/Spring-Bean解析分析过程.html　　作者: WhatAKitty" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span></p><p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。</p></div><br><br><style type="text/css">.copyright p .btn{margin-left:1em}.copyright:hover p .btn::after{content:"复制"}.copyright p .btn:hover{color:gray;cursor:pointer}</style></div><div class="article-footer"><div class="article-meta pull-left"><span class="post-categories"><i class="icon-categories"></i> <a href="/categories/Java/">Java</a>, <a href="/categories/Java/Spring/">Spring</a>, <a href="/categories/Java/Spring/SpringSources/">SpringSources</a> </span><span class="post-tags"><i class="icon-tags"></i> <a href="/tags/java/">java</a><a href="/tags/spring/">spring</a><a href="/tags/bean/">bean</a><a href="/tags/aop/">aop</a></span></div><script src="https://cdn.staticfile.org/mermaid/8.0.0/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"},".mermaid")</script><div class="article-meta pull-right"><span style="display:inline-block;width:83px"><a style="float:left;text-decoration:none" target="_blank" href="https://www.banquanyin.com/u/101709260007755"><img src="https://s1.banquanyin.com/c/icon-yin-24.png" title="更多授权" style="width:inherit"> </a><a target="_blank" href="https://101709260007755.bqy.mobi"><img src="https://s1.banquanyin.com/c/icon-auth-cr-24.png" title="获取授权" style="width:inherit"></a></span></div></div><div style="text-align:center;margin-top:80px"><div id="cyReward" role="cylabs" data-use="reward" sid="81b61235e790b482d00f462fb0215b3b" cid="1"></div></div></article><div id="SOHUCS" sid="81b61235e790b482d00f462fb0215b3b"></div><script type="text/javascript">!function(){var t,e,n,a="cytdcyLLd",c="1243e90ae1a56c027241ecf5b99daeda";if((window.innerWidth||document.documentElement.clientWidth)<960){var d=document.getElementsByTagName("head")[0]||document.head||document.documentElement,o=document.createElement("script");o.type="text/javascript",o.charset="utf-8",o.id="changyan_mobile_js",o.src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id="+a+"&conf="+c,d.appendChild(o)}else t=function(){window.changyan.api.config({appid:a,conf:c})},e=document.getElementsByTagName("head")[0]||document.head||document.documentElement,(n=document.createElement("script")).setAttribute("type","text/javascript"),n.setAttribute("charset","UTF-8"),n.setAttribute("src","https://changyan.sohu.com/upload/changyan.js"),window.attachEvent?n.onreadystatechange=function(){var e=n.readyState;"loaded"!==e&&"complete"!==e||(n.onreadystatechange=null,t())}:n.onload=t,e.appendChild(n)}()</script></main><footer class="site-footer"><script async src="//static.xuqiang.me/busuanzi.pure.mini.js"></script><p class="site-info">Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a><br>&copy; 2020 WhatAKitty | <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><br><a href="https://blog.whatakitty.com">浙ICP备15019585号</a> <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010602008839" style="display:block;line-height:20px"><span style="display:inline-block;line-height:20px;vertical-align:middle"><img src="https://static.xuqiang.me/public/images/beian.png" style="width:20px;height:20px"></span><span style="display:inline-block;height:20px;line-height:20px;margin:0 0 0 5px">浙公网安备 33010602008839号</span></a></p></footer><script async src="https://www.googletagmanager.com/gtag/js?id=UA-35184058-2"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-35184058-2")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?1d4c4cd810512d2fddb7187b7939389a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></div></body></html>
